openapi: 3.0.0
paths:
  /:
    get:
      operationId: AppController_getHello
      parameters: []
      responses:
        '200':
          description: ''
      tags: &ref_0
        - App
  /config/info:
    get:
      operationId: AppController_getConfigInfo
      parameters: []
      responses:
        '200':
          description: ''
      tags: *ref_0
  /auth/login:
    post:
      operationId: AuthController_login
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginDto'
      responses:
        '200':
          description: Login realizado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponseDto'
        '401':
          description: Credenciais inválidas
      summary: Login de usuário
      tags: &ref_1
        - auth
  /auth/me:
    get:
      operationId: AuthController_getProfile
      parameters: []
      responses:
        '200':
          description: Informações do usuário
        '401':
          description: Não autorizado
      security:
        - bearer: []
      summary: Obter informações do usuário autenticado
      tags: *ref_1
  /auth/me/company-status:
    get:
      description: >-
        Retorna o status de vinculação do usuário com empresa. Usado no
        onboarding para decidir se usuário precisa cadastrar ou vincular
        empresa.
      operationId: AuthController_getCompanyStatus
      parameters: []
      responses:
        '200':
          description: Status de vinculação
          content:
            application/json:
              schema:
                properties:
                  status:
                    type: string
                    enum:
                      - no_company
                      - pending_access
                      - pending_validation
                      - active
                  needsOnboarding:
                    type: boolean
                  message:
                    type: string
                  user:
                    type: object
                  company:
                    type: object
                    nullable: true
                  pendingAccessRequest:
                    type: object
                    nullable: true
        '401':
          description: Não autorizado
      security:
        - bearer: []
      summary: Verificar status de vinculação do usuário
      tags: *ref_1
  /auth/logout:
    post:
      operationId: AuthController_logout
      parameters: []
      responses:
        '200':
          description: Logout realizado com sucesso
      security:
        - bearer: []
      summary: Logout do usuário
      tags: *ref_1
  /auth/users:
    get:
      operationId: AuthController_listUsers
      parameters:
        - name: role
          required: false
          in: query
          description: Filtrar por role
          schema:
            type: string
      responses:
        '200':
          description: Lista de usuários
        '401':
          description: Não autorizado
      security:
        - bearer: []
      summary: Listar usuários (filtrado por role)
      tags: *ref_1
  /users:
    post:
      operationId: UserController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserDto'
      responses:
        '201':
          description: Usuário criado com sucesso
        '400':
          description: Dados inválidos
        '403':
          description: Acesso negado
        '409':
          description: Email ou CNPJ já cadastrado
      security: &ref_2
        - bearer: []
      summary: Criar novo usuário (Admin/Gestor)
      tags: &ref_3
        - users
    get:
      operationId: UserController_findAll
      parameters:
        - name: role
          required: false
          in: query
          description: Filtrar por role
          schema:
            type: string
        - name: search
          required: false
          in: query
          description: Buscar por nome ou email
          schema:
            type: string
      responses:
        '200':
          description: Lista de usuários
        '403':
          description: Acesso negado
      security: *ref_2
      summary: Listar todos os usuários
      tags: *ref_3
  /users/stats:
    get:
      operationId: UserController_getUserStats
      parameters: []
      responses:
        '200':
          description: Estatísticas de usuários
        '403':
          description: Acesso negado
      security: *ref_2
      summary: Obter estatísticas de usuários
      tags: *ref_3
  /users/admin-stats:
    get:
      operationId: UserController_getAdminStats
      parameters: []
      responses:
        '200':
          description: Estatísticas de admins
        '403':
          description: Acesso negado
      security: *ref_2
      summary: Obter estatísticas de admins
      tags: *ref_3
  /users/pending-access:
    get:
      operationId: UserController_findPendingAccessRequests
      parameters:
        - name: companyId
          required: false
          in: query
          description: Filtrar por empresa
          schema:
            type: string
      responses:
        '200':
          description: Lista de solicitações pendentes
        '403':
          description: Acesso negado
      security: *ref_2
      summary: Listar usuários com solicitação de acesso pendente
      tags: *ref_3
  /users/company/{companyId}:
    get:
      operationId: UserController_findByCompany
      parameters:
        - name: companyId
          required: true
          in: path
          description: ID da empresa
          schema:
            type: string
      responses:
        '200':
          description: Lista de usuários da empresa
        '403':
          description: Acesso negado
      security: *ref_2
      summary: Listar usuários de uma empresa
      tags: *ref_3
  /users/group/{groupId}:
    get:
      operationId: UserController_findByGroup
      parameters:
        - name: groupId
          required: true
          in: path
          description: ID do grupo
          schema:
            type: string
      responses:
        '200':
          description: Lista de usuários do grupo
        '403':
          description: Acesso negado
      security: *ref_2
      summary: Listar usuários de um grupo
      tags: *ref_3
  /users/{id}:
    get:
      operationId: UserController_findOne
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Usuário encontrado
        '403':
          description: Acesso negado
        '404':
          description: Usuário não encontrado
      security: *ref_2
      summary: Obter usuário por ID
      tags: *ref_3
    patch:
      operationId: UserController_update
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserDto'
      responses:
        '200':
          description: Usuário atualizado com sucesso
        '403':
          description: Acesso negado
        '404':
          description: Usuário não encontrado
        '409':
          description: Email já cadastrado
      security: *ref_2
      summary: Atualizar usuário (Admin/Gestor)
      tags: *ref_3
    delete:
      operationId: UserController_remove
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Usuário deletado com sucesso
        '403':
          description: Acesso negado
        '404':
          description: Usuário não encontrado
      security: *ref_2
      summary: Deletar usuário (Admin apenas)
      tags: *ref_3
  /users/{id}/assign-admin:
    post:
      description: >-
        FAMBRAS designa oficialmente um usuário como admin da empresa ou grupo.
        Remove status de admin temporário.
      operationId: UserController_assignAdmin
      parameters:
        - name: id
          required: true
          in: path
          description: ID do usuário
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssignAdminDto'
      responses:
        '200':
          description: Admin designado com sucesso
        '400':
          description: Usuário sem empresa ou grupo
        '403':
          description: Acesso negado
        '404':
          description: Usuário não encontrado
      security: *ref_2
      summary: Designar usuário como admin (FAMBRAS)
      tags: *ref_3
  /users/{id}/set-temporary-admin:
    post:
      description: Define usuário como admin temporário (usado durante cadastro de empresa)
      operationId: UserController_setTemporaryAdmin
      parameters:
        - name: id
          required: true
          in: path
          description: ID do usuário
          schema:
            type: string
      responses:
        '200':
          description: Admin temporário definido
        '400':
          description: Usuário sem empresa
        '404':
          description: Usuário não encontrado
      security: *ref_2
      summary: Definir admin temporário
      tags: *ref_3
  /requests:
    post:
      operationId: RequestController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRequestDto'
      responses:
        '201':
          description: 'Request created successfully (status: rascunho)'
        '400':
          description: Invalid industrial classification
        '404':
          description: Company not found
      security: &ref_4
        - bearer: []
      summary: Create new certification request
      tags: &ref_5
        - Requests
    get:
      operationId: RequestController_findAll
      parameters:
        - name: status
          required: false
          in: query
          description: Filter by status
          schema:
            enum:
              - rascunho
              - enviado
              - pendente
              - em_analise
              - aprovado
              - rejeitado
              - cancelado
            type: string
        - name: requestType
          required: false
          in: query
          description: Filter by request type
          schema:
            enum:
              - nova
              - inicial
              - renovacao
              - ampliacao
              - manutencao
              - adequacao
            type: string
        - name: certificationType
          required: false
          in: query
          description: Filter by certification type
          schema:
            enum:
              - C1
              - C2
              - C3
              - C4
              - C5
              - C6
              - produto
              - processo
              - servico
            type: string
        - name: companyId
          required: false
          in: query
          description: Filter by company ID
          schema:
            format: uuid
            type: string
        - name: companyName
          required: false
          in: query
          description: Search by company name
          schema:
            example: Halal Foods
            type: string
        - name: protocol
          required: false
          in: query
          description: Search by protocol number
          schema:
            example: REQ-20260115-00001
            type: string
        - name: skip
          required: false
          in: query
          description: 'Pagination offset (default: 0)'
          schema:
            minimum: 0
            default: 0
            example: 0
            type: number
        - name: take
          required: false
          in: query
          description: 'Items per page (default: 50)'
          schema:
            minimum: 1
            default: 50
            example: 50
            type: number
      responses:
        '200':
          description: Paginated requests list
      security: *ref_4
      summary: List all certification requests with filters
      tags: *ref_5
  /requests/{id}/submit:
    patch:
      operationId: RequestController_submit
      parameters:
        - name: id
          required: true
          in: path
          description: Request ID
          schema:
            type: string
      responses:
        '200':
          description: 'Request submitted (status: pendente, protocol generated)'
        '400':
          description: Can only submit draft requests
        '404':
          description: Request not found
      security: *ref_4
      summary: Submit request for analysis (generates protocol)
      tags: *ref_5
  /requests/{id}/start-review:
    patch:
      operationId: RequestController_startReview
      parameters:
        - name: id
          required: true
          in: path
          description: Request ID
          schema:
            type: string
      responses:
        '200':
          description: 'Request review started (status: em_analise)'
        '400':
          description: Can only review pending requests
        '404':
          description: Request not found
      security: *ref_4
      summary: Start request review
      tags: *ref_5
  /requests/{id}/approve:
    patch:
      operationId: RequestController_approve
      parameters:
        - name: id
          required: true
          in: path
          description: Request ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApproveRequestDto'
      responses:
        '200':
          description: Request approved, Process created
        '400':
          description: Can only approve requests under analysis
        '404':
          description: Request not found
      security: *ref_4
      summary: Approve request (creates Process automatically)
      tags: *ref_5
  /requests/{id}/reject:
    patch:
      operationId: RequestController_reject
      parameters:
        - name: id
          required: true
          in: path
          description: Request ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RejectRequestDto'
      responses:
        '200':
          description: Request rejected
        '400':
          description: Can only reject requests under analysis
        '404':
          description: Request not found
      security: *ref_4
      summary: Reject request
      tags: *ref_5
  /requests/company/{companyId}:
    get:
      operationId: RequestController_findByCompany
      parameters:
        - name: companyId
          required: true
          in: path
          description: Company ID
          schema:
            type: string
      responses:
        '200':
          description: Company requests found
      security: *ref_4
      summary: Get company's certification requests
      tags: *ref_5
  /requests/protocol/{protocol}:
    get:
      operationId: RequestController_findByProtocol
      parameters:
        - name: protocol
          required: true
          in: path
          description: Protocol number (e.g., REQ-20260115-00001)
          schema:
            type: string
      responses:
        '200':
          description: Request found
        '404':
          description: Request not found
      security: *ref_4
      summary: Get request by protocol number
      tags: *ref_5
  /requests/stats/summary:
    get:
      operationId: RequestController_getStats
      parameters: []
      responses:
        '200':
          description: Statistics including total, by status, by type, avg review time
      security: *ref_4
      summary: Get certification request statistics
      tags: *ref_5
  /requests/{id}:
    patch:
      operationId: RequestController_update
      parameters:
        - name: id
          required: true
          in: path
          description: Request ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRequestDto'
      responses:
        '200':
          description: Request updated
        '400':
          description: Can only update draft requests
        '404':
          description: Request not found
      security: *ref_4
      summary: Update certification request (draft only)
      tags: *ref_5
    delete:
      operationId: RequestController_cancel
      parameters:
        - name: id
          required: true
          in: path
          description: Request ID
          schema:
            type: string
      responses:
        '200':
          description: Request cancelled
        '400':
          description: Cannot cancel approved or rejected requests
        '404':
          description: Request not found
      security: *ref_4
      summary: Cancel certification request
      tags: *ref_5
    get:
      operationId: RequestController_findById
      parameters:
        - name: id
          required: true
          in: path
          description: Request ID
          schema:
            type: string
      responses:
        '200':
          description: Request found
        '404':
          description: Request not found
      security: *ref_4
      summary: Get certification request by ID
      tags: *ref_5
  /companies:
    post:
      description: Register a new company with CNPJ validation. CNPJ must be unique.
      operationId: CompanyController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCompanyDto'
      responses:
        '201':
          description: Company registered successfully
        '400':
          description: Invalid CNPJ format
        '409':
          description: CNPJ already registered
      security: &ref_6
        - bearer: []
      summary: Register new company
      tags: &ref_7
        - Companies
    get:
      description: List companies with optional filters and pagination
      operationId: CompanyController_findAll
      parameters:
        - name: isActive
          required: false
          in: query
          description: Filter by active status
          schema:
            example: true
            type: boolean
        - name: isVerified
          required: false
          in: query
          description: Filter by verification status
          schema:
            example: true
            type: boolean
        - name: cidade
          required: false
          in: query
          description: Filter by city
          schema:
            example: São Paulo
            type: string
        - name: estado
          required: false
          in: query
          description: Filter by state
          schema:
            example: SP
            type: string
        - name: pais
          required: false
          in: query
          description: Filter by country
          schema:
            example: Brasil
            type: string
        - name: search
          required: false
          in: query
          description: Search by company name or CNPJ
          schema:
            example: Halal
            type: string
        - name: skip
          required: false
          in: query
          description: Pagination offset
          schema:
            minimum: 0
            default: 0
            example: 0
            type: number
        - name: take
          required: false
          in: query
          description: Items per page
          schema:
            minimum: 1
            default: 50
            example: 50
            type: number
      responses:
        '200':
          description: Companies retrieved successfully
      security: *ref_6
      summary: List companies
      tags: *ref_7
  /companies/search/query:
    get:
      description: >-
        Search companies by name or CNPJ with fuzzy matching. Returns max 20
        results.
      operationId: CompanyController_search
      parameters:
        - name: query
          required: true
          in: query
          description: Search query (min 2 characters)
          schema:
            minLength: 2
            example: Halal
            type: string
      responses:
        '200':
          description: Search results
      security: *ref_6
      summary: Quick search companies
      tags: *ref_7
  /companies/stats/summary:
    get:
      description: >-
        Get comprehensive statistics including totals, status counts, and
        geographic distribution
      operationId: CompanyController_getStats
      parameters: []
      responses:
        '200':
          description: Statistics retrieved successfully
      security: *ref_6
      summary: Get company statistics (admin only)
      tags: *ref_7
  /companies/cnpj/{cnpj}:
    get:
      description: Find company using CNPJ (Brazilian tax ID)
      operationId: CompanyController_findByCnpj
      parameters:
        - name: cnpj
          required: true
          in: path
          description: 'Company CNPJ (format: XX.XXX.XXX/XXXX-XX)'
          schema:
            example: 12.345.678/0001-90
            type: string
      responses:
        '200':
          description: Company found
        '404':
          description: Company not found
      security: *ref_6
      summary: Get company by CNPJ
      tags: *ref_7
  /companies/cnpj/{cnpj}/exists:
    get:
      description: Check if a CNPJ is already registered. Used during onboarding.
      operationId: CompanyController_checkCnpjExists
      parameters:
        - name: cnpj
          required: true
          in: path
          description: CNPJ to check
          schema:
            type: string
      responses:
        '200':
          description: Returns whether CNPJ exists and basic company info if it does
      security: *ref_6
      summary: Check if CNPJ exists
      tags: *ref_7
  /companies/pending-validation:
    get:
      description: List companies awaiting FAMBRAS validation after registration
      operationId: CompanyController_findPendingValidation
      parameters: []
      responses:
        '200':
          description: List of companies pending validation
      security: *ref_6
      summary: Get companies pending validation (FAMBRAS)
      tags: *ref_7
  /companies/register:
    post:
      description: >-
        Register a new company during onboarding. Creates company with
        pendingValidation=true, creates group if independent, and sets user as
        temporary admin.
      operationId: CompanyController_register
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterCompanyDto'
      responses:
        '201':
          description: Company registered, pending validation
        '400':
          description: Invalid CNPJ
        '409':
          description: CNPJ already registered or user already has company
      security: *ref_6
      summary: Register company (onboarding)
      tags: *ref_7
  /companies/{id}:
    patch:
      description: Update company details. CNPJ cannot be changed. Company must be active.
      operationId: CompanyController_update
      parameters:
        - name: id
          required: true
          in: path
          description: Company UUID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCompanyDto'
      responses:
        '200':
          description: Company updated successfully
        '400':
          description: Company is inactive
        '404':
          description: Company not found
      security: *ref_6
      summary: Update company
      tags: *ref_7
    delete:
      description: >-
        Deactivate company (soft delete). Cannot delete if company has active
        processes.
      operationId: CompanyController_softDelete
      parameters:
        - name: id
          required: true
          in: path
          description: Company UUID
          schema:
            type: string
      responses:
        '200':
          description: Company deactivated successfully
        '400':
          description: Company already inactive or has active processes
        '404':
          description: Company not found
      security: *ref_6
      summary: Soft delete company (admin only)
      tags: *ref_7
    get:
      description: >-
        Get company details including verifier information and related entity
        counts
      operationId: CompanyController_findById
      parameters:
        - name: id
          required: true
          in: path
          description: Company UUID
          schema:
            example: 550e8400-e29b-41d4-a716-446655440000
            type: string
      responses:
        '200':
          description: Company found
        '404':
          description: Company not found
      security: *ref_6
      summary: Get company by ID
      tags: *ref_7
  /companies/{id}/verify:
    patch:
      description: Mark company as verified. Records admin who verified and timestamp.
      operationId: CompanyController_verify
      parameters:
        - name: id
          required: true
          in: path
          description: Company UUID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyCompanyDto'
      responses:
        '200':
          description: Company verified successfully
        '400':
          description: Company already verified or inactive
        '404':
          description: Company not found
      security: *ref_6
      summary: Verify company (admin only)
      tags: *ref_7
  /companies/{id}/unverify:
    patch:
      description: Remove verification status from company
      operationId: CompanyController_unverify
      parameters:
        - name: id
          required: true
          in: path
          description: Company UUID
          schema:
            type: string
      responses:
        '200':
          description: Verification removed successfully
        '400':
          description: Company is not verified
        '404':
          description: Company not found
      security: *ref_6
      summary: Remove company verification (admin only)
      tags: *ref_7
  /companies/{id}/reactivate:
    patch:
      description: Reactivate a previously deactivated company
      operationId: CompanyController_reactivate
      parameters:
        - name: id
          required: true
          in: path
          description: Company UUID
          schema:
            type: string
      responses:
        '200':
          description: Company reactivated successfully
        '400':
          description: Company is already active
        '404':
          description: Company not found
      security: *ref_6
      summary: Reactivate company (admin only)
      tags: *ref_7
  /companies/{id}/validate:
    post:
      description: >-
        FAMBRAS validates a company registration. Sets pendingValidation=false
        and isVerified=true.
      operationId: CompanyController_validateCompany
      parameters:
        - name: id
          required: true
          in: path
          description: Company UUID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValidateCompanyDto'
      responses:
        '200':
          description: Company validated successfully
        '400':
          description: Company is not pending validation
        '404':
          description: Company not found
      security: *ref_6
      summary: Validate company (FAMBRAS)
      tags: *ref_7
  /companies/{id}/reject-validation:
    post:
      description: FAMBRAS rejects a company registration.
      operationId: CompanyController_rejectValidation
      parameters:
        - name: id
          required: true
          in: path
          description: Company UUID
          schema:
            type: string
      responses:
        '200':
          description: Company validation rejected
        '400':
          description: Company is not pending validation
        '404':
          description: Company not found
      security: *ref_6
      summary: Reject company validation (FAMBRAS)
      tags: *ref_7
  /company-groups:
    post:
      description: >-
        Manually create a new company group. Usually groups are created
        automatically when registering a company.
      operationId: CompanyGroupController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCompanyGroupDto'
      responses:
        '201':
          description: Group created successfully
      security: &ref_8
        - bearer: []
      summary: Create company group (admin only)
      tags: &ref_9
        - Company Groups
    get:
      description: List all company groups with filters and pagination
      operationId: CompanyGroupController_findAll
      parameters:
        - name: search
          required: false
          in: query
          description: Search by name or document
          schema:
            example: BRF
            type: string
        - name: skip
          required: false
          in: query
          description: Pagination offset
          schema:
            minimum: 0
            default: 0
            type: number
        - name: take
          required: false
          in: query
          description: Items per page
          schema:
            minimum: 1
            maximum: 100
            default: 50
            type: number
      responses:
        '200':
          description: Groups retrieved successfully
      security: *ref_8
      summary: List company groups (FAMBRAS staff)
      tags: *ref_9
  /company-groups/my:
    get:
      description: Get the company group associated with the current user
      operationId: CompanyGroupController_findMyGroup
      parameters: []
      responses:
        '200':
          description: Group found
        '404':
          description: User has no associated group
      security: *ref_8
      summary: Get my company group
      tags: *ref_9
  /company-groups/{id}/stats:
    get:
      description: >-
        Get statistics for a company group including counts of companies,
        plants, certifications, etc.
      operationId: CompanyGroupController_getStats
      parameters:
        - name: id
          required: true
          in: path
          description: Group UUID
          schema:
            type: string
      responses:
        '200':
          description: Statistics retrieved
        '404':
          description: Group not found
      security: *ref_8
      summary: Get group statistics
      tags: *ref_9
  /company-groups/{id}/companies:
    get:
      description: Get all companies belonging to a company group
      operationId: CompanyGroupController_getCompanies
      parameters:
        - name: id
          required: true
          in: path
          description: Group UUID
          schema:
            type: string
      responses:
        '200':
          description: Companies retrieved
        '404':
          description: Group not found
      security: *ref_8
      summary: Get companies in group
      tags: *ref_9
    post:
      description: Add an existing company to a company group. Used for merging companies.
      operationId: CompanyGroupController_addCompany
      parameters:
        - name: id
          required: true
          in: path
          description: Group UUID
          schema:
            type: string
      responses:
        '201':
          description: Company added to group
        '400':
          description: Company already in group
        '404':
          description: Group or company not found
      security: *ref_8
      summary: Add company to group (admin only)
      tags: *ref_9
  /company-groups/{id}/companies/{companyId}:
    delete:
      description: >-
        Remove a company from a group. A new group will be created for the
        company.
      operationId: CompanyGroupController_removeCompany
      parameters:
        - name: id
          required: true
          in: path
          description: Group UUID
          schema:
            type: string
        - name: companyId
          required: true
          in: path
          description: Company UUID to remove
          schema:
            type: string
      responses:
        '200':
          description: Company removed from group
        '400':
          description: Cannot remove only company in group
        '404':
          description: Group or company not found
      security: *ref_8
      summary: Remove company from group (admin only)
      tags: *ref_9
  /company-groups/{id}/headquarters/{companyId}:
    patch:
      description: Set a company as the headquarters of the group
      operationId: CompanyGroupController_setHeadquarters
      parameters:
        - name: id
          required: true
          in: path
          description: Group UUID
          schema:
            type: string
        - name: companyId
          required: true
          in: path
          description: Company UUID to set as headquarters
          schema:
            type: string
      responses:
        '200':
          description: Headquarters set
        '400':
          description: Company not in group
        '404':
          description: Group or company not found
      security: *ref_8
      summary: Set headquarters (admin only)
      tags: *ref_9
  /company-groups/{id}:
    patch:
      description: Update company group details
      operationId: CompanyGroupController_update
      parameters:
        - name: id
          required: true
          in: path
          description: Group UUID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCompanyGroupDto'
      responses:
        '200':
          description: Group updated
        '404':
          description: Group not found
      security: *ref_8
      summary: Update company group
      tags: *ref_9
    delete:
      description: Delete an empty company group. Cannot delete if group has companies.
      operationId: CompanyGroupController_delete
      parameters:
        - name: id
          required: true
          in: path
          description: Group UUID
          schema:
            type: string
      responses:
        '200':
          description: Group deleted
        '400':
          description: Group has companies
        '404':
          description: Group not found
      security: *ref_8
      summary: Delete company group (admin only)
      tags: *ref_9
    get:
      description: Get company group details including companies and counts
      operationId: CompanyGroupController_findById
      parameters:
        - name: id
          required: true
          in: path
          description: Group UUID
          schema:
            type: string
      responses:
        '200':
          description: Group found
        '404':
          description: Group not found
      security: *ref_8
      summary: Get company group by ID
      tags: *ref_9
  /plants:
    post:
      description: Create a new manufacturing facility for a company
      operationId: PlantController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePlantDto'
      responses:
        '201':
          description: Plant created successfully
        '404':
          description: Company not found
        '409':
          description: Plant code already exists
      security: &ref_10
        - bearer: []
      summary: Create new plant
      tags: &ref_11
        - Plants
    get:
      description: List plants with optional filters and pagination
      operationId: PlantController_findAll
      parameters:
        - name: companyId
          required: false
          in: query
          description: Filter by company
          schema:
            type: string
        - name: codeType
          required: false
          in: query
          description: Filter by code type (sif, sie, sim, internal)
          schema:
            type: string
            enum:
              - sif
              - sie
              - sim
              - internal
        - name: isActive
          required: false
          in: query
          description: Filter by active status
          schema:
            type: boolean
        - name: state
          required: false
          in: query
          description: Filter by state
          schema:
            type: string
        - name: search
          required: false
          in: query
          description: Search by name or code
          schema:
            type: string
        - name: skip
          required: false
          in: query
          description: Número de registros a pular
          schema:
            minimum: 0
            default: 0
            type: number
        - name: take
          required: false
          in: query
          description: Número de registros a retornar
          schema:
            minimum: 1
            maximum: 100
            default: 50
            type: number
      responses:
        '200':
          description: Plants retrieved
      security: *ref_10
      summary: List plants
      tags: *ref_11
  /plants/my:
    get:
      description: Get plants for the current user's company
      operationId: PlantController_findMyPlants
      parameters: []
      responses:
        '200':
          description: Plants retrieved
        '404':
          description: User has no company
      security: *ref_10
      summary: Get my plants
      tags: *ref_11
  /plants/company/{companyId}:
    get:
      description: Get all plants for a specific company
      operationId: PlantController_findByCompany
      parameters:
        - name: companyId
          required: true
          in: path
          description: Company UUID
          schema:
            type: string
      responses:
        '200':
          description: Plants retrieved
      security: *ref_10
      summary: Get company plants
      tags: *ref_11
  /plants/stats:
    get:
      description: Get statistics about plants (counts by type, state, etc.)
      operationId: PlantController_getStats
      parameters:
        - name: companyId
          required: false
          in: query
          description: Filter stats by company
          schema:
            type: string
      responses:
        '200':
          description: Statistics retrieved
      security: *ref_10
      summary: Get plant statistics
      tags: *ref_11
  /plants/{id}/certifications:
    get:
      description: Get all certifications associated with a plant
      operationId: PlantController_getCertifications
      parameters:
        - name: id
          required: true
          in: path
          description: Plant UUID
          schema:
            type: string
      responses:
        '200':
          description: Certifications retrieved
        '404':
          description: Plant not found
      security: *ref_10
      summary: Get plant certifications
      tags: *ref_11
  /plants/{id}:
    patch:
      description: Update plant details
      operationId: PlantController_update
      parameters:
        - name: id
          required: true
          in: path
          description: Plant UUID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePlantDto'
      responses:
        '200':
          description: Plant updated
        '404':
          description: Plant not found
        '409':
          description: Plant code already exists
      security: *ref_10
      summary: Update plant
      tags: *ref_11
    delete:
      description: >-
        Soft delete plant (set isActive = false). Cannot delete if has active
        certifications.
      operationId: PlantController_softDelete
      parameters:
        - name: id
          required: true
          in: path
          description: Plant UUID
          schema:
            type: string
      responses:
        '200':
          description: Plant deactivated
        '400':
          description: Plant has active certifications
        '404':
          description: Plant not found
      security: *ref_10
      summary: Deactivate plant
      tags: *ref_11
    get:
      description: Get plant details including company and certifications
      operationId: PlantController_findById
      parameters:
        - name: id
          required: true
          in: path
          description: Plant UUID
          schema:
            type: string
      responses:
        '200':
          description: Plant found
        '404':
          description: Plant not found
      security: *ref_10
      summary: Get plant by ID
      tags: *ref_11
  /plants/{id}/reactivate:
    patch:
      description: Reactivate a previously deactivated plant
      operationId: PlantController_reactivate
      parameters:
        - name: id
          required: true
          in: path
          description: Plant UUID
          schema:
            type: string
      responses:
        '200':
          description: Plant reactivated
        '400':
          description: Plant is already active
        '404':
          description: Plant not found
      security: *ref_10
      summary: Reactivate plant
      tags: *ref_11
  /shared-suppliers:
    post:
      description: Add a new supplier to a company group. Requires approval.
      operationId: SharedSupplierController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSharedSupplierDto'
      responses:
        '201':
          description: Supplier created
        '404':
          description: Group not found
      security: &ref_12
        - bearer: []
      summary: Create shared supplier
      tags: &ref_13
        - Shared Suppliers
    get:
      description: List all shared suppliers with optional filters
      operationId: SharedSupplierController_findAll
      parameters:
        - name: groupId
          required: false
          in: query
          description: Filtrar por grupo empresarial
          schema:
            type: string
        - name: status
          required: false
          in: query
          description: Filtrar por status
          schema:
            enum:
              - pending
              - approved
              - rejected
              - suspended
            type: string
        - name: search
          required: false
          in: query
          description: Busca por nome ou documento
          schema:
            type: string
        - name: skip
          required: false
          in: query
          description: Número de registros a pular
          schema:
            default: 0
            type: number
        - name: take
          required: false
          in: query
          description: Número de registros a retornar
          schema:
            default: 50
            type: number
      responses:
        '200':
          description: Suppliers retrieved
      security: *ref_12
      summary: List shared suppliers
      tags: *ref_13
  /shared-suppliers/group/{groupId}:
    get:
      description: Get all suppliers for a specific company group
      operationId: SharedSupplierController_findByGroup
      parameters:
        - name: groupId
          required: true
          in: path
          description: Group UUID
          schema:
            type: string
        - name: onlyApproved
          required: false
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: Suppliers retrieved
      security: *ref_12
      summary: Get group suppliers
      tags: *ref_13
  /shared-suppliers/expiring:
    get:
      description: Get suppliers with Halal certificates expiring soon
      operationId: SharedSupplierController_findExpiring
      parameters:
        - name: days
          required: false
          in: query
          description: 'Days ahead to check (default: 30)'
          schema:
            type: number
      responses:
        '200':
          description: Suppliers retrieved
      security: *ref_12
      summary: Get expiring certificates
      tags: *ref_13
  /shared-suppliers/{id}/approve:
    patch:
      description: Approve a pending supplier (FAMBRAS staff only)
      operationId: SharedSupplierController_approve
      parameters:
        - name: id
          required: true
          in: path
          description: Supplier UUID
          schema:
            type: string
      responses:
        '200':
          description: Supplier approved
        '400':
          description: Supplier already approved
      security: *ref_12
      summary: Approve supplier
      tags: *ref_13
  /shared-suppliers/{id}/reject:
    patch:
      description: Reject a pending supplier (FAMBRAS staff only)
      operationId: SharedSupplierController_reject
      parameters:
        - name: id
          required: true
          in: path
          description: Supplier UUID
          schema:
            type: string
      responses:
        '200':
          description: Supplier rejected
      security: *ref_12
      summary: Reject supplier
      tags: *ref_13
  /shared-suppliers/{id}/suspend:
    patch:
      description: Suspend an approved supplier
      operationId: SharedSupplierController_suspend
      parameters:
        - name: id
          required: true
          in: path
          description: Supplier UUID
          schema:
            type: string
      responses:
        '200':
          description: Supplier suspended
      security: *ref_12
      summary: Suspend supplier
      tags: *ref_13
  /shared-suppliers/{id}/reactivate:
    patch:
      description: Reactivate a suspended supplier
      operationId: SharedSupplierController_reactivate
      parameters:
        - name: id
          required: true
          in: path
          description: Supplier UUID
          schema:
            type: string
      responses:
        '200':
          description: Supplier reactivated
      security: *ref_12
      summary: Reactivate supplier
      tags: *ref_13
  /shared-suppliers/{id}:
    patch:
      description: Update supplier details
      operationId: SharedSupplierController_update
      parameters:
        - name: id
          required: true
          in: path
          description: Supplier UUID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSharedSupplierDto'
      responses:
        '200':
          description: Supplier updated
      security: *ref_12
      summary: Update supplier
      tags: *ref_13
    delete:
      description: Delete a supplier (only pending or rejected)
      operationId: SharedSupplierController_delete
      parameters:
        - name: id
          required: true
          in: path
          description: Supplier UUID
          schema:
            type: string
      responses:
        '204':
          description: Supplier deleted
        '400':
          description: Cannot delete approved supplier
      security: *ref_12
      summary: Delete supplier
      tags: *ref_13
    get:
      description: Get shared supplier details
      operationId: SharedSupplierController_findById
      parameters:
        - name: id
          required: true
          in: path
          description: Supplier UUID
          schema:
            type: string
      responses:
        '200':
          description: Supplier found
        '404':
          description: Supplier not found
      security: *ref_12
      summary: Get supplier by ID
      tags: *ref_13
  /corporate-documents:
    post:
      description: Add a new document to a company group
      operationId: CorporateDocumentController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCorporateDocumentDto'
      responses:
        '201':
          description: Document created
        '404':
          description: Group not found
      security: &ref_14
        - bearer: []
      summary: Create corporate document
      tags: &ref_15
        - Corporate Documents
    get:
      description: List all corporate documents with optional filters
      operationId: CorporateDocumentController_findAll
      parameters:
        - name: groupId
          required: false
          in: query
          description: Filtrar por grupo empresarial
          schema:
            type: string
        - name: category
          required: false
          in: query
          description: Filtrar por categoria
          schema:
            enum:
              - bpf
              - appcc
              - procedimento
              - manual
              - politica
              - outro
            type: string
        - name: isActive
          required: false
          in: query
          description: Filtrar por status ativo
          schema:
            type: boolean
        - name: search
          required: false
          in: query
          description: Busca por nome
          schema:
            type: string
        - name: skip
          required: false
          in: query
          description: Número de registros a pular
          schema:
            default: 0
            type: number
        - name: take
          required: false
          in: query
          description: Número de registros a retornar
          schema:
            default: 50
            type: number
      responses:
        '200':
          description: Documents retrieved
      security: *ref_14
      summary: List corporate documents
      tags: *ref_15
  /corporate-documents/group/{groupId}:
    get:
      description: Get all documents for a specific company group
      operationId: CorporateDocumentController_findByGroup
      parameters:
        - name: groupId
          required: true
          in: path
          description: Group UUID
          schema:
            type: string
        - name: category
          required: false
          in: query
          schema:
            enum:
              - bpf
              - appcc
              - procedimento
              - manual
              - politica
              - outro
            type: string
        - name: onlyActive
          required: false
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: Documents retrieved
      security: *ref_14
      summary: Get group documents
      tags: *ref_15
  /corporate-documents/group/{groupId}/stats:
    get:
      description: Get document count by category for a group
      operationId: CorporateDocumentController_getStats
      parameters:
        - name: groupId
          required: true
          in: path
          description: Group UUID
          schema:
            type: string
      responses:
        '200':
          description: Statistics retrieved
      security: *ref_14
      summary: Get document statistics
      tags: *ref_15
  /corporate-documents/expiring:
    get:
      description: Get documents with validity expiring soon
      operationId: CorporateDocumentController_findExpiring
      parameters:
        - name: days
          required: false
          in: query
          description: 'Days ahead to check (default: 30)'
          schema:
            type: number
      responses:
        '200':
          description: Documents retrieved
      security: *ref_14
      summary: Get expiring documents
      tags: *ref_15
  /corporate-documents/{id}:
    patch:
      description: Update document details
      operationId: CorporateDocumentController_update
      parameters:
        - name: id
          required: true
          in: path
          description: Document UUID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCorporateDocumentDto'
      responses:
        '200':
          description: Document updated
      security: *ref_14
      summary: Update document
      tags: *ref_15
    delete:
      description: Soft delete document (set isActive = false)
      operationId: CorporateDocumentController_softDelete
      parameters:
        - name: id
          required: true
          in: path
          description: Document UUID
          schema:
            type: string
      responses:
        '200':
          description: Document deactivated
      security: *ref_14
      summary: Deactivate document
      tags: *ref_15
    get:
      description: Get corporate document details
      operationId: CorporateDocumentController_findById
      parameters:
        - name: id
          required: true
          in: path
          description: Document UUID
          schema:
            type: string
      responses:
        '200':
          description: Document found
        '404':
          description: Document not found
      security: *ref_14
      summary: Get document by ID
      tags: *ref_15
  /corporate-documents/{id}/permanent:
    delete:
      description: Permanently delete an inactive document
      operationId: CorporateDocumentController_delete
      parameters:
        - name: id
          required: true
          in: path
          description: Document UUID
          schema:
            type: string
      responses:
        '204':
          description: Document deleted
        '400':
          description: Cannot delete active document
      security: *ref_14
      summary: Permanently delete document (admin only)
      tags: *ref_15
  /corporate-documents/{id}/reactivate:
    patch:
      description: Reactivate a deactivated document
      operationId: CorporateDocumentController_reactivate
      parameters:
        - name: id
          required: true
          in: path
          description: Document UUID
          schema:
            type: string
      responses:
        '200':
          description: Document reactivated
      security: *ref_14
      summary: Reactivate document
      tags: *ref_15
  /processes:
    post:
      description: Cria um novo processo de certificação com dados do wizard multi-step
      operationId: ProcessController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProcessDto'
      responses:
        '201':
          description: Processo criado com sucesso
        '400':
          description: Dados inválidos
        '404':
          description: Empresa não encontrada
      security: &ref_16
        - bearer: []
      summary: Criar novo processo de certificação (Empresa)
      tags: &ref_17
        - processes
    get:
      description: |-
        Lista processos com filtros baseados no role do usuário:
        - empresa: apenas seus próprios processos
        - analista: processos atribuídos a ele
        - gestor/admin: todos os processos com filtros opcionais
      operationId: ProcessController_findAll
      parameters:
        - name: priority
          required: false
          in: query
          description: Filtrar por prioridade (gestor/admin apenas)
          schema:
            enum:
              - baixa
              - media
              - alta
              - urgente
            type: string
        - name: phase
          required: false
          in: query
          description: Filtrar por fase (gestor/admin apenas)
          schema:
            enum:
              - cadastro_solicitacao
              - analise_documental_inicial
              - elaboracao_proposta
              - negociacao_proposta
              - proposta_aprovada
              - elaboracao_contrato
              - assinatura_contrato
              - avaliacao_documental
              - planejamento_auditoria
              - auditoria_estagio1
              - auditoria_estagio2
              - analise_nao_conformidades
              - correcao_nao_conformidades
              - validacao_correcoes
              - comite_tecnico
              - emissao_certificado
              - certificado_emitido
            type: string
        - name: status
          required: false
          in: query
          description: Filtrar por status (gestor/admin apenas)
          schema:
            enum:
              - rascunho
              - pendente
              - em_andamento
              - aguardando_documentos
              - analise_documental
              - analise_tecnica
              - aguardando_auditoria
              - proposta_enviada
              - aguardando_assinatura
              - em_auditoria
              - concluido
              - aprovado
              - reprovado
              - certificado
              - cancelado
              - suspenso
            type: string
      responses:
        '200':
          description: Lista de processos retornada com sucesso
      security: *ref_16
      summary: Listar processos
      tags: *ref_17
  /processes/{id}:
    get:
      description: >-
        Retorna detalhes completos do processo.

        Auto-assign: Se analista abrir processo pendente sem analista, será
        automaticamente atribuído.
      operationId: ProcessController_findOne
      parameters:
        - name: id
          required: true
          in: path
          description: ID do processo
          schema:
            type: string
      responses:
        '200':
          description: Detalhes do processo
        '404':
          description: Processo não encontrado
      security: *ref_16
      summary: Obter detalhes do processo
      tags: *ref_17
    put:
      description: >-
        Atualiza os dados do processo pela empresa.

        Só pode ser usado enquanto o processo estiver em rascunho/pendente E não
        tiver analista atribuído.
      operationId: ProcessController_update
      parameters:
        - name: id
          required: true
          in: path
          description: ID do processo
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProcessDto'
      responses:
        '200':
          description: Processo atualizado com sucesso
        '400':
          description: >-
            Processo já foi assumido por analista ou não pode ser editado neste
            status
        '403':
          description: Acesso negado a este processo
        '404':
          description: Processo não encontrado
      security: *ref_16
      summary: Atualizar dados do processo (Empresa)
      tags: *ref_17
  /processes/{id}/can-edit:
    get:
      description: Retorna se a empresa ainda pode editar o processo
      operationId: ProcessController_canEdit
      parameters:
        - name: id
          required: true
          in: path
          description: ID do processo
          schema:
            type: string
      responses:
        '200':
          description: Status de edição retornado
      security: *ref_16
      summary: Verificar se processo pode ser editado (Empresa)
      tags: *ref_17
  /processes/{id}/submit:
    post:
      description: >-
        Submete o processo de rascunho para pendente, disponibilizando para
        atribuição de analista
      operationId: ProcessController_submitWizard
      parameters:
        - name: id
          required: true
          in: path
          description: ID do processo
          schema:
            type: string
      responses:
        '200':
          description: Processo submetido com sucesso
        '400':
          description: Processo já foi submetido
        '403':
          description: Acesso negado a este processo
        '404':
          description: Processo não encontrado
      security: *ref_16
      summary: Submeter processo (Empresa)
      tags: *ref_17
  /processes/{id}/status:
    patch:
      description: |-
        Atualiza o status do processo com validação de permissões.
        Cria registro de histórico e sincroniza com Request.
      operationId: ProcessController_updateStatus
      parameters:
        - name: id
          required: true
          in: path
          description: ID do processo
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProcessStatusDto'
      responses:
        '200':
          description: Status atualizado com sucesso
        '403':
          description: Usuário não pode atuar nesta fase
        '404':
          description: Processo não encontrado
      security: *ref_16
      summary: Atualizar status do processo (Analista/Gestor/Auditor)
      tags: *ref_17
  /processes/{id}/assign:
    post:
      description: >-
        Atribui analista ao processo e avança automaticamente para fase de
        análise documental inicial.

        Cria registro de histórico de fase.
      operationId: ProcessController_assignAnalyst
      parameters:
        - name: id
          required: true
          in: path
          description: ID do processo
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssignAnalystDto'
      responses:
        '200':
          description: Analista atribuído com sucesso
        '400':
          description: Usuário não possui role de analista ou gestor
        '404':
          description: Processo ou analista não encontrado
      security: *ref_16
      summary: Atribuir analista ao processo (Gestor)
      tags: *ref_17
  /processes/{id}/advance-phase:
    post:
      description: |-
        Avança o processo para a próxima fase com validação de regras.
        Valida se todas as condições da fase atual foram cumpridas.
        Atualiza status do processo e Request em transação atômica.
      operationId: ProcessController_advancePhase
      parameters:
        - name: id
          required: true
          in: path
          description: ID do processo
          schema:
            type: string
        - name: notes
          required: false
          in: query
          description: Notas sobre o avanço de fase
          schema: {}
      responses:
        '200':
          description: Fase avançada com sucesso
        '400':
          description: Não é possível avançar para próxima fase (validação falhou)
        '403':
          description: Usuário não pode avançar esta fase
        '404':
          description: Processo não encontrado
      security: *ref_16
      summary: Avançar para próxima fase (Analista/Gestor/Auditor)
      tags: *ref_17
  /proposals:
    post:
      operationId: ProposalController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProposalDto'
      responses:
        '201':
          description: Proposal created successfully
        '400':
          description: Process already has a proposal
        '404':
          description: Process not found
      security: &ref_18
        - bearer: []
      summary: Create new proposal for a process
      tags: &ref_19
        - Proposals
    get:
      operationId: ProposalController_findAll
      parameters:
        - name: status
          required: false
          in: query
          description: Filter by status
          schema:
            enum:
              - rascunho
              - calculada
              - enviada
              - aceita
              - recusada
              - expirada
            type: string
        - name: createdBy
          required: false
          in: query
          description: Filter by creator user ID
          schema:
            type: string
        - name: skip
          required: false
          in: query
          description: 'Pagination offset (default: 0)'
          schema:
            type: number
        - name: take
          required: false
          in: query
          description: 'Items per page (default: 50)'
          schema:
            type: number
      responses:
        '200':
          description: Paginated proposals list
      security: *ref_18
      summary: Get all proposals with optional filters
      tags: *ref_19
  /proposals/calculate:
    post:
      operationId: ProposalController_calculate
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CalculationInputDto'
      responses:
        '200':
          description: Calculation breakdown returned
      security: *ref_18
      summary: Calculate proposal values without saving (preview)
      tags: *ref_19
  /proposals/check-expired:
    post:
      operationId: ProposalController_checkExpired
      parameters: []
      responses:
        '200':
          description: Number of proposals marked as expired
      security: *ref_18
      summary: Check and mark expired proposals (background job)
      tags: *ref_19
  /proposals/stats/summary:
    get:
      operationId: ProposalController_getStats
      parameters: []
      responses:
        '200':
          description: Statistics including total, by status, avg/total value
      security: *ref_18
      summary: Get proposal statistics
      tags: *ref_19
  /proposals/process/{processId}:
    get:
      operationId: ProposalController_findByProcessId
      parameters:
        - name: processId
          required: true
          in: path
          description: Process ID
          schema:
            type: string
      responses:
        '200':
          description: Proposal found or null
      security: *ref_18
      summary: Get proposal by process ID
      tags: *ref_19
  /proposals/{id}/recalculate:
    patch:
      operationId: ProposalController_recalculate
      parameters:
        - name: id
          required: true
          in: path
          description: Proposal ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CalculationInputDto'
      responses:
        '200':
          description: Proposal recalculated
        '400':
          description: Cannot recalculate accepted/rejected proposal
        '404':
          description: Proposal not found
      security: *ref_18
      summary: Recalculate proposal with new inputs
      tags: *ref_19
  /proposals/{id}/adjust:
    patch:
      operationId: ProposalController_adjust
      parameters:
        - name: id
          required: true
          in: path
          description: Proposal ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdjustProposalDto'
      responses:
        '200':
          description: Adjustment applied (may include warning if >20%)
        '400':
          description: Cannot adjust accepted/rejected proposal
        '404':
          description: Proposal not found
      security: *ref_18
      summary: Apply manual adjustment to proposal value
      tags: *ref_19
  /proposals/{id}/send:
    patch:
      operationId: ProposalController_send
      parameters:
        - name: id
          required: true
          in: path
          description: Proposal ID
          schema:
            type: string
      responses:
        '200':
          description: Proposal sent
        '400':
          description: Can only send draft or calculated proposals
        '404':
          description: Proposal not found
      security: *ref_18
      summary: Send proposal to company (sets 30-day expiration)
      tags: *ref_19
  /proposals/{id}/respond:
    patch:
      operationId: ProposalController_respond
      parameters:
        - name: id
          required: true
          in: path
          description: Proposal ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RespondProposalDto'
      responses:
        '200':
          description: Response recorded, process advanced if accepted
        '400':
          description: Can only respond to sent proposals / Proposal expired
        '404':
          description: Proposal not found
      security: *ref_18
      summary: >-
        Company responds to proposal (accept/reject). If accepted, advances
        process to contract signing.
      tags: *ref_19
  /proposals/{id}/responses:
    get:
      operationId: ProposalController_getResponseHistory
      parameters:
        - name: id
          required: true
          in: path
          description: Proposal ID
          schema:
            type: string
      responses:
        '200':
          description: Response history (empty if none)
      security: *ref_18
      summary: Get proposal response history (negotiation history)
      tags: *ref_19
  /proposals/{id}:
    get:
      operationId: ProposalController_findById
      parameters:
        - name: id
          required: true
          in: path
          description: Proposal ID
          schema:
            type: string
      responses:
        '200':
          description: Proposal found
        '404':
          description: Proposal not found
      security: *ref_18
      summary: Get proposal by ID
      tags: *ref_19
  /proposals/pricing-tables:
    post:
      operationId: ProposalController_createPricingTable
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePricingTableDto'
      responses:
        '201':
          description: Pricing table created
        '400':
          description: Version already exists
      security: *ref_18
      summary: Create new pricing table (auto-deactivates previous)
      tags: *ref_19
    get:
      operationId: ProposalController_findAllPricingTables
      parameters:
        - name: isActive
          required: false
          in: query
          description: Filter by active status
          schema:
            type: boolean
        - name: skip
          required: false
          in: query
          description: Pagination offset
          schema:
            type: number
        - name: take
          required: false
          in: query
          description: Items per page
          schema:
            type: number
      responses:
        '200':
          description: Paginated pricing tables list
      security: *ref_18
      summary: Get all pricing tables with optional filters
      tags: *ref_19
  /proposals/pricing-tables/active:
    get:
      operationId: ProposalController_findActivePricingTable
      parameters: []
      responses:
        '200':
          description: Active pricing table
        '404':
          description: No active table found
      security: *ref_18
      summary: Get active pricing table
      tags: *ref_19
  /proposals/pricing-tables/compare/{id1}/{id2}:
    get:
      operationId: ProposalController_comparePricingTables
      parameters:
        - name: id1
          required: true
          in: path
          description: First pricing table ID
          schema:
            type: string
        - name: id2
          required: true
          in: path
          description: Second pricing table ID
          schema:
            type: string
      responses:
        '200':
          description: Comparison with differences list
        '404':
          description: One or both tables not found
      security: *ref_18
      summary: Compare two pricing table versions
      tags: *ref_19
  /proposals/pricing-tables/{id}:
    patch:
      operationId: ProposalController_updatePricingTable
      parameters:
        - name: id
          required: true
          in: path
          description: Pricing table ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePricingTableDto'
      responses:
        '200':
          description: New version created
        '404':
          description: Pricing table not found
      security: *ref_18
      summary: Update pricing table (creates new version with incremented number)
      tags: *ref_19
    get:
      operationId: ProposalController_findPricingTableById
      parameters:
        - name: id
          required: true
          in: path
          description: Pricing table ID
          schema:
            type: string
      responses:
        '200':
          description: Pricing table found
        '404':
          description: Pricing table not found
      security: *ref_18
      summary: Get pricing table by ID
      tags: *ref_19
  /audits:
    post:
      operationId: AuditController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAuditDto'
      responses:
        '201':
          description: Audit created successfully
        '400':
          description: Process not in auditoria phase
        '404':
          description: Process not found
      security: &ref_20
        - bearer: []
      summary: Create new audit for a process
      tags: &ref_21
        - Audits
    get:
      operationId: AuditController_findAll
      parameters:
        - name: status
          required: false
          in: query
          description: Filter by status
          schema:
            enum:
              - agendado
              - em_andamento
              - concluido
              - cancelado
            type: string
        - name: result
          required: false
          in: query
          description: Filter by result
          schema:
            enum:
              - aprovado
              - aprovado_condicional
              - reprovado
            type: string
        - name: skip
          required: false
          in: query
          description: 'Pagination offset (default: 0)'
          schema:
            type: number
        - name: take
          required: false
          in: query
          description: 'Items per page (default: 50)'
          schema:
            type: number
      responses:
        '200':
          description: Paginated audits list
      security: *ref_20
      summary: Get all audits with optional filters
      tags: *ref_21
  /audits/{id}:
    patch:
      operationId: AuditController_update
      parameters:
        - name: id
          required: true
          in: path
          description: Audit ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAuditDto'
      responses:
        '200':
          description: Audit updated
        '400':
          description: Can only update scheduled audits
        '404':
          description: Audit not found
      security: *ref_20
      summary: Update audit details (date, location, notes)
      tags: *ref_21
    delete:
      operationId: AuditController_delete
      parameters:
        - name: id
          required: true
          in: path
          description: Audit ID
          schema:
            type: string
      responses:
        '204':
          description: Audit deleted
        '400':
          description: Can only delete scheduled or canceled audits
        '404':
          description: Audit not found
      security: *ref_20
      summary: Delete an audit (only if agendado or cancelado)
      tags: *ref_21
    get:
      operationId: AuditController_findById
      parameters:
        - name: id
          required: true
          in: path
          description: Audit ID
          schema:
            type: string
      responses:
        '200':
          description: Audit found
        '404':
          description: Audit not found
      security: *ref_20
      summary: Get audit by ID
      tags: *ref_21
  /audits/{id}/start:
    patch:
      operationId: AuditController_start
      parameters:
        - name: id
          required: true
          in: path
          description: Audit ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StartAuditDto'
      responses:
        '200':
          description: Audit started
        '400':
          description: Can only start scheduled audits / Date not arrived
        '404':
          description: Audit not found
      security: *ref_20
      summary: Start audit execution (agendado → em_andamento)
      tags: *ref_21
  /audits/{id}/complete:
    patch:
      operationId: AuditController_complete
      parameters:
        - name: id
          required: true
          in: path
          description: Audit ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompleteAuditDto'
      responses:
        '200':
          description: Audit completed
        '400':
          description: Can only complete in-progress audits
        '404':
          description: Audit not found
      security: *ref_20
      summary: Complete audit with findings (em_andamento → concluido)
      tags: *ref_21
  /audits/{id}/finalize:
    patch:
      operationId: AuditController_finalize
      parameters:
        - name: id
          required: true
          in: path
          description: Audit ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FinalizeAuditDto'
      responses:
        '200':
          description: Audit finalized, process advanced if approved
        '400':
          description: Can only finalize completed audits / Already finalized
        '404':
          description: Audit not found
      security: *ref_20
      summary: >-
        Finalize audit with decision (approve/reject). If approved, advances
        process to certificate issuance.
      tags: *ref_21
  /audits/{id}/cancel:
    patch:
      operationId: AuditController_cancel
      parameters:
        - name: id
          required: true
          in: path
          description: Audit ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CancelAuditDto'
      responses:
        '200':
          description: Audit canceled
        '400':
          description: Can only cancel scheduled audits
        '404':
          description: Audit not found
      security: *ref_20
      summary: Cancel a scheduled audit
      tags: *ref_21
  /audits/upcoming:
    get:
      operationId: AuditController_getUpcomingAudits
      parameters:
        - name: daysAhead
          required: false
          in: query
          description: 'Number of days ahead (default: 30)'
          schema:
            minimum: 1
            example: 30
            type: number
        - name: userRole
          required: false
          in: query
          description: User role for filtering
          schema:
            example: empresa
            type: string
        - name: companyId
          required: false
          in: query
          description: Company ID for filtering (empresa role)
          schema:
            example: cluid123
            type: string
      responses:
        '200':
          description: Upcoming audits
      security: *ref_20
      summary: 'Get upcoming audits scheduled in the next N days (default: 30)'
      tags: *ref_21
  /audits/by-status:
    get:
      operationId: AuditController_findByStatus
      parameters:
        - name: status
          required: true
          in: query
          description: Audit status
          schema:
            enum:
              - agendado
              - em_andamento
              - concluido
              - cancelado
            type: string
        - name: userRole
          required: false
          in: query
          description: User role for filtering
          schema:
            example: empresa
            type: string
        - name: companyId
          required: false
          in: query
          description: Company ID for filtering (empresa role)
          schema:
            example: cluid123
            type: string
      responses:
        '200':
          description: Audits by status
      security: *ref_20
      summary: Get audits filtered by status
      tags: *ref_21
  /audits/stats/summary:
    get:
      operationId: AuditController_getStats
      parameters: []
      responses:
        '200':
          description: >-
            Statistics including total, by status, by result, avg
            non-conformities
      security: *ref_20
      summary: Get audit statistics
      tags: *ref_21
  /audits/process/{processId}:
    get:
      operationId: AuditController_findByProcessId
      parameters:
        - name: processId
          required: true
          in: path
          description: Process ID
          schema:
            type: string
      responses:
        '200':
          description: Audits found
      security: *ref_20
      summary: Get all audits for a process
      tags: *ref_21
  /audits/certification/{certificationId}:
    get:
      operationId: AuditController_findByCertificationId
      parameters:
        - name: certificationId
          required: true
          in: path
          description: Certification ID
          schema:
            type: string
      responses:
        '200':
          description: Audits found
      security: *ref_20
      summary: Get all audits for a certification
      tags: *ref_21
  /audits/unannounced/missing:
    get:
      description: >-
        PR 7.1 Rev. 22 - 7.5.3.5: At least one unannounced audit per 3-year
        cycle is mandatory
      operationId: AuditController_getCertificationsMissingUnannounced
      parameters: []
      responses:
        '200':
          description: List of certifications missing unannounced audit
      security: *ref_20
      summary: Get certifications missing unannounced audit in current cycle
      tags: *ref_21
  /audits/unannounced/status/{certificationId}:
    get:
      description: >-
        Returns compliance status, last unannounced date, and days until cycle
        end
      operationId: AuditController_getUnannouncedStatus
      parameters:
        - name: certificationId
          required: true
          in: path
          description: Certification ID
          schema:
            type: string
      responses:
        '200':
          description: Unannounced audit status
        '404':
          description: Certification not found
      security: *ref_20
      summary: Get unannounced audit compliance status for a certification
      tags: *ref_21
  /audits/stage-interval/issues:
    get:
      description: >-
        PR 7.1 Rev. 22: Maximum 6 months between Stage 1 and Stage 2. Returns
        certifications approaching or exceeding this limit.
      operationId: AuditController_getCertificationsWithStageIntervalIssues
      parameters: []
      responses:
        '200':
          description: List of certifications with interval issues
      security: *ref_20
      summary: Get certifications with Stage 1-2 interval issues
      tags: *ref_21
  /audits/stage-interval/status/{certificationId}:
    get:
      description: >-
        Returns interval status, days remaining, and whether Stage 1 needs to be
        repeated
      operationId: AuditController_getStageIntervalStatus
      parameters:
        - name: certificationId
          required: true
          in: path
          description: Certification ID
          schema:
            type: string
      responses:
        '200':
          description: Stage interval status
      security: *ref_20
      summary: Get Stage 1-2 interval status for a certification
      tags: *ref_21
  /audits/stage-interval/validate/{certificationId}:
    get:
      description: Checks if Stage 2 can be scheduled without exceeding the 6-month limit
      operationId: AuditController_validateStage1To2Interval
      parameters:
        - name: certificationId
          required: true
          in: path
          description: Certification ID
          schema:
            type: string
      responses:
        '200':
          description: Validation result
      security: *ref_20
      summary: Validate Stage 1-2 interval before scheduling Stage 2
      tags: *ref_21
  /contracts:
    post:
      operationId: ContractController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateContractDto'
      responses:
        '201':
          description: Contract created successfully
        '400':
          description: Process not in assinatura_contrato phase
        '404':
          description: Process or company not found
        '409':
          description: Contract already exists for this process
      security: &ref_22
        - bearer: []
      summary: Create new contract for a process
      tags: &ref_23
        - Contracts
    get:
      operationId: ContractController_findAll
      parameters:
        - name: status
          required: false
          in: query
          description: Filter by status
          schema:
            enum:
              - rascunho
              - enviado
              - em_negociacao
              - assinado
              - cancelado
            type: string
        - name: contractType
          required: false
          in: query
          description: Filter by type
          schema:
            enum:
              - proposta
              - contrato
            type: string
        - name: processId
          required: false
          in: query
          description: Filter by process ID
          schema:
            example: 123e4567-e89b-12d3-a456-426614174000
            type: string
        - name: companyId
          required: false
          in: query
          description: Filter by company ID
          schema:
            example: 123e4567-e89b-12d3-a456-426614174001
            type: string
        - name: skip
          required: false
          in: query
          description: 'Pagination offset (default: 0)'
          schema:
            minimum: 0
            example: 0
            type: number
        - name: take
          required: false
          in: query
          description: 'Items per page (default: 50)'
          schema:
            minimum: 1
            example: 50
            type: number
      responses:
        '200':
          description: Paginated contracts list
      security: *ref_22
      summary: Get all contracts with optional filters
      tags: *ref_23
  /contracts/{id}/send:
    patch:
      operationId: ContractController_send
      parameters:
        - name: id
          required: true
          in: path
          description: Contract ID
          schema:
            type: string
      responses:
        '200':
          description: Contract sent
        '400':
          description: Can only send draft contracts
        '404':
          description: Contract not found
      security: *ref_22
      summary: Send contract to company (rascunho → enviado)
      tags: *ref_23
  /contracts/{id}/negotiate:
    patch:
      operationId: ContractController_negotiate
      parameters:
        - name: id
          required: true
          in: path
          description: Contract ID
          schema:
            type: string
      responses:
        '200':
          description: Contract marked as negotiating
        '400':
          description: Can only negotiate sent contracts
        '404':
          description: Contract not found
      security: *ref_22
      summary: Mark contract as in negotiation (enviado → em_negociacao)
      tags: *ref_23
  /contracts/{id}/sign:
    patch:
      operationId: ContractController_sign
      parameters:
        - name: id
          required: true
          in: path
          description: Contract ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignContractDto'
      responses:
        '200':
          description: Contract signed, process advanced to audit planning
        '400':
          description: Can only sign sent or negotiating contracts
        '404':
          description: Contract not found
      security: *ref_22
      summary: >-
        Sign contract (enviado/em_negociacao → assinado). Advances process to
        planejamento_auditoria.
      tags: *ref_23
  /contracts/{id}/cancel:
    patch:
      operationId: ContractController_cancel
      parameters:
        - name: id
          required: true
          in: path
          description: Contract ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CancelContractDto'
      responses:
        '200':
          description: Contract cancelled
        '400':
          description: Cannot cancel signed contracts
        '404':
          description: Contract not found
      security: *ref_22
      summary: Cancel contract. Cannot cancel signed contracts.
      tags: *ref_23
  /contracts/stats/summary:
    get:
      operationId: ContractController_getStats
      parameters: []
      responses:
        '200':
          description: Statistics including total, by status, total value, avg signing time
      security: *ref_22
      summary: Get contract statistics
      tags: *ref_23
  /contracts/process/{processId}:
    get:
      operationId: ContractController_findByProcessId
      parameters:
        - name: processId
          required: true
          in: path
          description: Process ID
          schema:
            type: string
      responses:
        '200':
          description: Contract found or null
      security: *ref_22
      summary: Get contract by process ID
      tags: *ref_23
  /contracts/{id}:
    patch:
      operationId: ContractController_update
      parameters:
        - name: id
          required: true
          in: path
          description: Contract ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateContractDto'
      responses:
        '200':
          description: Contract updated
        '400':
          description: Can only update draft contracts
        '404':
          description: Contract not found
      security: *ref_22
      summary: Update contract details (only draft contracts)
      tags: *ref_23
    get:
      operationId: ContractController_findById
      parameters:
        - name: id
          required: true
          in: path
          description: Contract ID
          schema:
            type: string
      responses:
        '200':
          description: Contract found
        '404':
          description: Contract not found
      security: *ref_22
      summary: Get contract by ID
      tags: *ref_23
  /document-requests:
    post:
      operationId: DocumentRequestController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDocumentRequestDto'
      responses:
        '201':
          description: Document request created successfully
        '404':
          description: Process not found
      security: &ref_24
        - bearer: []
      summary: Create new document request for a process
      tags: &ref_25
        - Document Requests
    get:
      operationId: DocumentRequestController_findAll
      parameters:
        - name: processId
          required: false
          in: query
          description: Filter by process ID
          schema:
            type: string
        - name: status
          required: false
          in: query
          description: Filter by status
          schema:
            enum:
              - pendente
              - atendido
              - cancelado
            type: string
        - name: documentType
          required: false
          in: query
          description: Filter by document type
          schema:
            enum:
              - contrato_social
              - certidao_negativa
              - alvara_funcionamento
              - laudo_tecnico
              - licenca_sanitaria
              - fotos
              - videos
              - laudos
              - manual_bpf
              - fluxograma_processo
              - lista_fornecedores
              - certificado_ingredientes
              - analise_produto
              - rotulo_produto
              - outros
            type: string
        - name: overdue
          required: false
          in: query
          description: Filter overdue requests
          schema:
            type: boolean
        - name: skip
          required: false
          in: query
          description: 'Pagination offset (default: 0)'
          schema:
            minimum: 0
            type: number
        - name: take
          required: false
          in: query
          description: 'Items per page (default: 50)'
          schema:
            minimum: 1
            type: number
      responses:
        '200':
          description: Paginated document requests list
      security: *ref_24
      summary: Get all document requests with optional filters
      tags: *ref_25
  /document-requests/{id}:
    patch:
      operationId: DocumentRequestController_update
      parameters:
        - name: id
          required: true
          in: path
          description: Document request ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateDocumentRequestDto'
      responses:
        '200':
          description: Document request updated
        '400':
          description: Can only update pending requests
        '404':
          description: Document request not found
      security: *ref_24
      summary: Update document request (only pending requests)
      tags: *ref_25
    get:
      operationId: DocumentRequestController_findById
      parameters:
        - name: id
          required: true
          in: path
          description: Document request ID
          schema:
            type: string
      responses:
        '200':
          description: Document request found
        '404':
          description: Document request not found
      security: *ref_24
      summary: Get document request by ID
      tags: *ref_25
    delete:
      operationId: DocumentRequestController_delete
      parameters:
        - name: id
          required: true
          in: path
          description: Document request ID
          schema:
            type: string
      responses:
        '200':
          description: Document request deleted
        '404':
          description: Document request not found
      security: *ref_24
      summary: Delete document request
      tags: *ref_25
  /document-requests/process/{processId}:
    get:
      operationId: DocumentRequestController_findByProcessId
      parameters:
        - name: processId
          required: true
          in: path
          description: Process ID
          schema:
            type: string
      responses:
        '200':
          description: Document requests found
      security: *ref_24
      summary: Get all document requests for a process
      tags: *ref_25
  /document-requests/{id}/fulfill:
    patch:
      operationId: DocumentRequestController_fulfill
      parameters:
        - name: id
          required: true
          in: path
          description: Document request ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FulfillDocumentRequestDto'
      responses:
        '200':
          description: Document request fulfilled successfully
        '400':
          description: Can only fulfill pending requests
        '404':
          description: Document request or document not found
      security: *ref_24
      summary: >-
        Fulfill document request by linking uploaded document (pendente →
        atendido)
      tags: *ref_25
  /document-requests/{id}/cancel:
    patch:
      operationId: DocumentRequestController_cancel
      parameters:
        - name: id
          required: true
          in: path
          description: Document request ID
          schema:
            type: string
      responses:
        '200':
          description: Document request cancelled
        '400':
          description: Can only cancel pending requests
        '404':
          description: Document request not found
      security: *ref_24
      summary: Cancel document request (pendente → cancelado)
      tags: *ref_25
  /document-requests/process/{processId}/pending:
    get:
      operationId: DocumentRequestController_findPendingByProcessId
      parameters:
        - name: processId
          required: true
          in: path
          description: Process ID
          schema:
            type: string
      responses:
        '200':
          description: Pending document requests found
      security: *ref_24
      summary: Get pending document requests for a process
      tags: *ref_25
  /document-requests/overdue/all:
    get:
      operationId: DocumentRequestController_findOverdue
      parameters: []
      responses:
        '200':
          description: Overdue document requests found
      security: *ref_24
      summary: Get all overdue document requests
      tags: *ref_25
  /documents/request/{requestId}/ready:
    get:
      description: >-
        Verifies that the request exists in the database and is ready to receive
        document uploads. Use this endpoint before attempting document upload to
        prevent race conditions.
      operationId: DocumentController_checkRequestReady
      parameters:
        - name: requestId
          required: true
          in: path
          description: Request ID
          schema:
            type: string
      responses:
        '200':
          description: Request is ready for upload
          content:
            application/json:
              schema:
                type: object
                properties:
                  ready:
                    type: boolean
                    example: true
                  requestId:
                    type: string
                    example: uuid
        '404':
          description: Request not found
      security: &ref_26
        - bearer: []
      summary: Check if request is ready for document upload
      tags: &ref_27
        - Documents
  /documents/request/{requestId}:
    get:
      operationId: DocumentController_getDocumentsByRequest
      parameters:
        - name: requestId
          required: true
          in: path
          description: Request ID
          schema:
            type: string
      responses:
        '200':
          description: Documents found
      security: *ref_26
      summary: Get all documents for a request
      tags: *ref_27
  /documents/process/{processId}:
    get:
      operationId: DocumentController_getDocumentsByProcess
      parameters:
        - name: processId
          required: true
          in: path
          description: Process ID
          schema:
            type: string
      responses:
        '200':
          description: Documents found
      security: *ref_26
      summary: Get all documents for a process
      tags: *ref_27
  /documents/certification/{certificationId}:
    get:
      operationId: DocumentController_getDocumentsByCertification
      parameters:
        - name: certificationId
          required: true
          in: path
          description: Certification ID
          schema:
            type: string
      responses:
        '200':
          description: Documents found
      security: *ref_26
      summary: Get all documents for a certification
      tags: *ref_27
  /documents/upload:
    post:
      operationId: DocumentController_uploadDocument
      parameters: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: File to upload
                requestId:
                  type: string
                  description: Request ID to associate the document with
                certificationId:
                  type: string
                  description: Certification ID to associate the document with (optional)
                documentType:
                  type: string
                  enum:
                    - contrato_social
                    - certidao_negativa
                    - alvara_funcionamento
                    - laudo_tecnico
                    - licenca_sanitaria
                    - fotos
                    - videos
                    - laudos
                    - manual_bpf
                    - fluxograma_processo
                    - lista_fornecedores
                    - certificado_ingredientes
                    - analise_produto
                    - rotulo_produto
                    - outros
                  description: Type of document
                validUntil:
                  type: string
                  format: date
                  description: Document expiry date (optional)
              required:
                - file
                - requestId
                - documentType
      responses:
        '201':
          description: Document uploaded successfully
        '400':
          description: Invalid request or file
      security: *ref_26
      summary: Upload a document for a request
      tags: *ref_27
  /documents/{id}:
    delete:
      description: >-
        Deletes a document. Only allowed while the process is in
        rascunho/pendente status and not assigned to an analyst.
      operationId: DocumentController_deleteDocument
      parameters:
        - name: id
          required: true
          in: path
          description: Document ID
          schema:
            type: string
      responses:
        '200':
          description: Document deleted successfully
        '400':
          description: Document cannot be deleted (process already assigned or in progress)
        '403':
          description: Access denied to this document
        '404':
          description: Document not found
      security: *ref_26
      summary: Delete a document
      tags: *ref_27
  /documents/{id}/can-delete:
    get:
      description: Returns whether the company can still delete the document
      operationId: DocumentController_canDelete
      parameters:
        - name: id
          required: true
          in: path
          description: Document ID
          schema:
            type: string
      responses:
        '200':
          description: Delete status returned
      security: *ref_26
      summary: Check if document can be deleted
      tags: *ref_27
  /documents/{id}/download:
    get:
      description: Downloads the document file
      operationId: DocumentController_downloadDocument
      parameters:
        - name: id
          required: true
          in: path
          description: Document ID
          schema:
            type: string
      responses:
        '200':
          description: Document file
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '404':
          description: Document not found
      security: *ref_26
      summary: Download a document
      tags: *ref_27
  /comments:
    post:
      operationId: CommentController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCommentDto'
      responses:
        '201':
          description: Comment created successfully
        '404':
          description: Process not found
      security: &ref_28
        - bearer: []
      summary: Create new comment on a process
      tags: &ref_29
        - Comments
    get:
      operationId: CommentController_findAll
      parameters:
        - name: processId
          required: false
          in: query
          description: Filter by process ID
          schema:
            type: string
        - name: userId
          required: false
          in: query
          description: Filter by user ID (author)
          schema:
            type: string
        - name: isInternal
          required: false
          in: query
          description: Filter by internal flag
          schema:
            type: boolean
        - name: mentioned
          required: false
          in: query
          description: Filter by mentioned user ID
          schema:
            type: string
        - name: skip
          required: false
          in: query
          description: 'Pagination offset (default: 0)'
          schema:
            minimum: 0
            type: number
        - name: take
          required: false
          in: query
          description: 'Items per page (default: 50)'
          schema:
            minimum: 1
            type: number
      responses:
        '200':
          description: Paginated comments list
      security: *ref_28
      summary: Get all comments with optional filters
      tags: *ref_29
  /comments/{id}:
    patch:
      operationId: CommentController_update
      parameters:
        - name: id
          required: true
          in: path
          description: Comment ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCommentDto'
      responses:
        '200':
          description: Comment updated
        '403':
          description: Not comment owner
        '404':
          description: Comment not found
      security: *ref_28
      summary: Update comment (own comments only)
      tags: *ref_29
    delete:
      operationId: CommentController_delete
      parameters:
        - name: id
          required: true
          in: path
          description: Comment ID
          schema:
            type: string
      responses:
        '200':
          description: Comment deleted
        '403':
          description: Not comment owner
        '404':
          description: Comment not found
      security: *ref_28
      summary: Delete comment (own comments only)
      tags: *ref_29
    get:
      operationId: CommentController_findById
      parameters:
        - name: id
          required: true
          in: path
          description: Comment ID
          schema:
            type: string
      responses:
        '200':
          description: Comment found
        '404':
          description: Comment not found
      security: *ref_28
      summary: Get comment by ID
      tags: *ref_29
  /comments/process/{processId}:
    get:
      operationId: CommentController_findByProcessId
      parameters:
        - name: processId
          required: true
          in: path
          description: Process ID
          schema:
            type: string
        - name: includeInternal
          required: false
          in: query
          description: >-
            Include internal comments (default: true for staff, false for
            company)
          schema:
            type: boolean
      responses:
        '200':
          description: Comments found
      security: *ref_28
      summary: Get all comments for a process
      tags: *ref_29
  /comments/mentions/me:
    get:
      operationId: CommentController_findMyMentions
      parameters:
        - name: limit
          required: false
          in: query
          description: 'Maximum number of comments to return (default: 50)'
          schema:
            type: number
      responses:
        '200':
          description: Comments found
      security: *ref_28
      summary: Get comments where current user is mentioned
      tags: *ref_29
  /comments/user/{userId}:
    get:
      operationId: CommentController_findByUser
      parameters:
        - name: userId
          required: true
          in: path
          description: User ID
          schema:
            type: string
        - name: limit
          required: false
          in: query
          description: 'Maximum number of comments to return (default: 50)'
          schema:
            type: number
      responses:
        '200':
          description: Comments found
      security: *ref_28
      summary: Get comments by user
      tags: *ref_29
  /auditor-allocation/process/{processId}/allocate:
    patch:
      operationId: AuditorAllocationController_allocateAuditor
      parameters:
        - name: processId
          required: true
          in: path
          description: Process ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AllocateAuditorDto'
      responses:
        '200':
          description: Auditor allocated successfully
        '400':
          description: User is not an auditor
        '404':
          description: Process or auditor not found
      security: &ref_30
        - bearer: []
      summary: Allocate auditor to certification process
      tags: &ref_31
        - Auditor Allocation
  /auditor-allocation/process/{processId}/remove:
    patch:
      operationId: AuditorAllocationController_removeAuditor
      parameters:
        - name: processId
          required: true
          in: path
          description: Process ID
          schema:
            type: string
      responses:
        '200':
          description: Auditor removed successfully
        '400':
          description: Process has no auditor allocated
        '404':
          description: Process not found
      security: *ref_30
      summary: Remove auditor from certification process
      tags: *ref_31
  /auditor-allocation/auditor/{auditorId}/processes:
    get:
      operationId: AuditorAllocationController_findProcessesByAuditor
      parameters:
        - name: auditorId
          required: true
          in: path
          description: Auditor user ID
          schema:
            type: string
      responses:
        '200':
          description: Processes found
        '404':
          description: Auditor not found
      security: *ref_30
      summary: Get all processes assigned to an auditor
      tags: *ref_31
  /auditor-allocation/auditors:
    get:
      operationId: AuditorAllocationController_findAvailableAuditors
      parameters:
        - name: available
          required: false
          in: query
          description: Filter only available auditors (with capacity)
          schema:
            type: boolean
        - name: skip
          required: false
          in: query
          description: 'Pagination offset (default: 0)'
          schema:
            minimum: 0
            type: number
        - name: take
          required: false
          in: query
          description: 'Items per page (default: 50)'
          schema:
            minimum: 1
            type: number
      responses:
        '200':
          description: Auditors list with workload information
      security: *ref_30
      summary: List all auditors with optional filters
      tags: *ref_31
  /auditor-allocation/auditor/{auditorId}/workload:
    get:
      operationId: AuditorAllocationController_getAuditorWorkload
      parameters:
        - name: auditorId
          required: true
          in: path
          description: Auditor user ID
          schema:
            type: string
      responses:
        '200':
          description: >-
            Workload information including total, active, and completed
            processes
        '400':
          description: User is not an auditor
        '404':
          description: Auditor not found
      security: *ref_30
      summary: Get auditor's current workload
      tags: *ref_31
  /auditor-allocation/stats:
    get:
      operationId: AuditorAllocationController_getAuditorStats
      parameters: []
      responses:
        '200':
          description: Statistics including total auditors, allocations, and averages
      security: *ref_30
      summary: Get auditor allocation statistics
      tags: *ref_31
  /industrial-classification:
    get:
      description: >-
        Returns all groups with their categories and subcategories. Frontend
        compatibility endpoint.
      operationId: IndustrialClassificationController_getAll
      parameters: []
      responses:
        '200':
          description: Complete industrial classification tree
      security: &ref_32
        - bearer: []
      summary: Get complete industrial classification tree
      tags: &ref_33
        - Industrial Classification
  /industrial-classification/groups:
    get:
      description: >-
        Returns all active industrial groups. Use includeRelations=true to get
        complete taxonomy tree.
      operationId: IndustrialClassificationController_getAllGroups
      parameters:
        - name: includeRelations
          required: false
          in: query
          description: 'Include categories and subcategories (default: false)'
          schema:
            type: boolean
      responses:
        '200':
          description: List of industrial groups
      security: *ref_32
      summary: Get all industrial groups
      tags: *ref_33
  /industrial-classification/groups/{code}:
    get:
      operationId: IndustrialClassificationController_getGroupByCode
      parameters:
        - name: code
          required: true
          in: path
          description: Group code
          schema:
            example: FOOD
            type: string
      responses:
        '200':
          description: Industrial group
        '404':
          description: Group not found
      security: *ref_32
      summary: Get industrial group by code
      tags: *ref_33
  /industrial-classification/groups/{groupCode}/categories:
    get:
      operationId: IndustrialClassificationController_getCategoriesByGroup
      parameters:
        - name: groupCode
          required: true
          in: path
          description: Group code
          schema:
            example: FOOD
            type: string
      responses:
        '200':
          description: List of categories
        '404':
          description: Group not found
      security: *ref_32
      summary: Get all categories for a group
      tags: *ref_33
  /industrial-classification/categories/{code}:
    get:
      operationId: IndustrialClassificationController_getCategoryByCode
      parameters:
        - name: code
          required: true
          in: path
          description: Category code
          schema:
            example: DAIRY
            type: string
      responses:
        '200':
          description: Industrial category
        '404':
          description: Category not found
      security: *ref_32
      summary: Get industrial category by code
      tags: *ref_33
  /industrial-classification/categories/{categoryCode}/subcategories:
    get:
      operationId: IndustrialClassificationController_getSubcategoriesByCategory
      parameters:
        - name: categoryCode
          required: true
          in: path
          description: Category code
          schema:
            example: DAIRY
            type: string
      responses:
        '200':
          description: List of subcategories
        '404':
          description: Category not found
      security: *ref_32
      summary: Get all subcategories for a category
      tags: *ref_33
  /industrial-classification/categories/{code}/audit-days:
    get:
      description: Returns the estimated number of audit days required for this category
      operationId: IndustrialClassificationController_getAuditDays
      parameters:
        - name: code
          required: true
          in: path
          description: Category code
          schema:
            example: DAIRY
            type: string
      responses:
        '200':
          description: Audit days estimate
          content:
            application/json:
              schema:
                type: object
                properties:
                  categoryCode:
                    type: string
                  auditDays:
                    type: number
                    nullable: true
        '404':
          description: Category not found
      security: *ref_32
      summary: Get audit days estimate for a category
      tags: *ref_33
  /industrial-classification/path:
    get:
      description: Validates and returns the complete hierarchy for a classification
      operationId: IndustrialClassificationController_getClassificationPath
      parameters:
        - name: groupCode
          required: true
          in: query
          description: Group code
          schema:
            example: FOOD
            type: string
        - name: categoryCode
          required: true
          in: query
          description: Category code
          schema:
            example: DAIRY
            type: string
        - name: subcategoryCode
          required: true
          in: query
          description: Subcategory code
          schema:
            example: CHEESE
            type: string
      responses:
        '200':
          description: Complete classification path
        '404':
          description: Invalid classification - part of hierarchy not found
      security: *ref_32
      summary: Get complete classification path
      tags: *ref_33
  /industrial-classification/validate:
    get:
      description: Returns true if the group/category/subcategory chain exists
      operationId: IndustrialClassificationController_validateClassification
      parameters:
        - name: groupCode
          required: true
          in: query
          description: Group code
          schema:
            example: FOOD
            type: string
        - name: categoryCode
          required: true
          in: query
          description: Category code
          schema:
            example: DAIRY
            type: string
        - name: subcategoryCode
          required: true
          in: query
          description: Subcategory code
          schema:
            example: CHEESE
            type: string
      responses:
        '200':
          description: Validation result
          content:
            application/json:
              schema:
                type: object
                properties:
                  valid:
                    type: boolean
                  groupCode:
                    type: string
                  categoryCode:
                    type: string
                  subcategoryCode:
                    type: string
      security: *ref_32
      summary: Validate a classification combination
      tags: *ref_33
  /comercial/dashboard:
    get:
      operationId: ComercialController_getDashboard
      parameters: []
      responses:
        '200':
          description: Dashboard data with stats, recent proposals, and activity
      security: &ref_34
        - bearer: []
      summary: Get comercial dashboard data
      tags: &ref_35
        - Comercial
  /comercial/proposals:
    get:
      operationId: ComercialController_getProposals
      parameters:
        - name: status
          required: false
          in: query
          description: Filter by status
          schema:
            enum:
              - rascunho
              - calculada
              - enviada
              - aceita
              - recusada
              - expirada
            type: string
      responses:
        '200':
          description: List of all proposals
      security: *ref_34
      summary: Get all proposals for comercial view
      tags: *ref_35
  /manager/dashboard:
    get:
      operationId: ManagerController_getDashboard
      parameters: []
      responses:
        '200':
          description: Dados do dashboard retornados com sucesso
        '403':
          description: Acesso negado
      security: &ref_36
        - bearer: []
      summary: Obter dados do dashboard do gestor
      tags: &ref_37
        - manager
  /manager/dashboard/analysts:
    get:
      operationId: ManagerController_getAnalystPerformance
      parameters: []
      responses:
        '200':
          description: Performance dos analistas retornada com sucesso
        '403':
          description: Acesso negado
      security: *ref_36
      summary: Obter performance dos analistas
      tags: *ref_37
  /manager/approvals/pending:
    get:
      operationId: ManagerController_getPendingApprovals
      parameters: []
      responses:
        '200':
          description: Aprovações pendentes retornadas com sucesso
        '403':
          description: Acesso negado
      security: *ref_36
      summary: Obter aprovações pendentes
      tags: *ref_37
  /manager/users:
    get:
      operationId: ManagerController_listUsers
      parameters:
        - name: role
          required: false
          in: query
          description: Filtrar por role
          schema:
            type: string
      responses:
        '200':
          description: Lista de usuários
        '403':
          description: Acesso negado
      security: *ref_36
      summary: Listar usuários
      tags: *ref_37
    post:
      operationId: ManagerController_createUser
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserDto'
      responses:
        '201':
          description: Usuário criado com sucesso
        '400':
          description: Dados inválidos
        '403':
          description: Acesso negado
      security: *ref_36
      summary: Criar novo usuário
      tags: *ref_37
  /manager/users/{userId}:
    put:
      operationId: ManagerController_updateUser
      parameters:
        - name: userId
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserDto'
      responses:
        '200':
          description: Usuário atualizado com sucesso
        '403':
          description: Acesso negado
        '404':
          description: Usuário não encontrado
      security: *ref_36
      summary: Atualizar usuário
      tags: *ref_37
    delete:
      operationId: ManagerController_deleteUser
      parameters:
        - name: userId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Usuário deletado com sucesso
        '403':
          description: Acesso negado
        '404':
          description: Usuário não encontrado
      security: *ref_36
      summary: Deletar usuário (Admin apenas)
      tags: *ref_37
  /reports:
    get:
      description: >-
        Returns paginated list of completed audit reports. Auditors see only
        their own reports.
      operationId: ReportsController_findAll
      parameters:
        - name: status
          required: false
          in: query
          description: Filter by compliance status
          schema:
            enum:
              - COMPLIANT
              - NON_COMPLIANT
              - PENDING_CORRECTIONS
            type: string
        - name: stage
          required: false
          in: query
          description: Filter by audit stage
          schema:
            enum:
              - STAGE_1
              - STAGE_2
            type: string
        - name: search
          required: false
          in: query
          description: Search by company name or audit number
          schema:
            type: string
        - name: skip
          required: false
          in: query
          description: 'Pagination offset (default: 0)'
          schema:
            default: 0
            type: number
        - name: take
          required: false
          in: query
          description: 'Items per page (default: 50)'
          schema:
            default: 50
            type: number
      responses:
        '200':
          description: Paginated list of audit reports
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditReportListResponseDto'
      security: &ref_38
        - bearer: []
      summary: Get all audit reports with optional filters
      tags: &ref_39
        - Reports
  /reports/stats:
    get:
      description: >-
        Returns aggregate statistics for audit reports including compliance
        rates and NC counts.
      operationId: ReportsController_getStats
      parameters: []
      responses:
        '200':
          description: Report statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditReportStatsDto'
      security: *ref_38
      summary: Get audit report statistics
      tags: *ref_39
  /reports/my-reports:
    get:
      description: Returns only reports for audits conducted by the current user.
      operationId: ReportsController_findMyReports
      parameters:
        - name: status
          required: false
          in: query
          description: Filter by compliance status
          schema:
            enum:
              - COMPLIANT
              - NON_COMPLIANT
              - PENDING_CORRECTIONS
            type: string
        - name: stage
          required: false
          in: query
          description: Filter by audit stage
          schema:
            enum:
              - STAGE_1
              - STAGE_2
            type: string
        - name: search
          required: false
          in: query
          description: Search by company name or audit number
          schema:
            type: string
        - name: skip
          required: false
          in: query
          description: 'Pagination offset (default: 0)'
          schema:
            default: 0
            type: number
        - name: take
          required: false
          in: query
          description: 'Items per page (default: 50)'
          schema:
            default: 50
            type: number
      responses:
        '200':
          description: Auditor's reports
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditReportListResponseDto'
      security: *ref_38
      summary: Get current auditor's reports
      tags: *ref_39
  /reports/{id}/pdf:
    get:
      description: Generates and downloads the audit report as a PDF file.
      operationId: ReportsController_downloadPdf
      parameters:
        - name: id
          required: true
          in: path
          description: Audit ID
          schema:
            type: string
      responses:
        '200':
          description: PDF file stream
          content:
            application/pdf:
              schema:
                type: string
                format: binary
        '404':
          description: Report not found
      security: *ref_38
      summary: Download audit report as PDF
      tags: *ref_39
  /reports/{id}:
    get:
      description: Returns detailed information for a single audit report.
      operationId: ReportsController_findById
      parameters:
        - name: id
          required: true
          in: path
          description: Audit ID
          schema:
            type: string
      responses:
        '200':
          description: Audit report details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditReportDto'
        '404':
          description: Report not found
      security: *ref_38
      summary: Get audit report by ID
      tags: *ref_39
  /juridico/dashboard:
    get:
      description: >-
        Returns statistics, pending contracts, processes needing contracts, and
        recent activity for the legal department.
      operationId: JuridicoController_getDashboard
      parameters: []
      responses:
        '200':
          description: Dashboard data retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JuridicoDashboardResponseDto'
      security:
        - bearer: []
      summary: Get juridico dashboard data
      tags:
        - Juridico
  /certifications:
    post:
      description: Cria uma nova certificação para uma empresa
      operationId: CertificationController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCertificationDto'
      responses:
        '201':
          description: Certificação criada com sucesso
        '400':
          description: Dados inválidos
        '404':
          description: Empresa não encontrada
      security: &ref_40
        - bearer: []
      summary: Criar nova certificação
      tags: &ref_41
        - certifications
    get:
      description: Lista certificações com filtros e paginação
      operationId: CertificationController_findAll
      parameters:
        - name: status
          required: false
          in: query
          description: Filtrar por status
          schema:
            type: string
            enum:
              - em_solicitacao
              - ativa
              - suspensa
              - cancelada
              - expirada
              - recusada
        - name: certificationType
          required: false
          in: query
          description: Filtrar por tipo de certificação
          schema:
            type: string
            enum:
              - C1
              - C2
              - C3
              - C4
              - C5
              - C6
              - produto
              - processo
              - servico
        - name: companyId
          required: false
          in: query
          description: Filtrar por empresa
          schema:
            type: string
        - name: analystId
          required: false
          in: query
          description: Filtrar por analista
          schema:
            type: string
        - name: search
          required: false
          in: query
          description: Buscar por número da certificação ou razão social
          schema:
            type: string
        - name: page
          required: false
          in: query
          description: Página (começa em 1)
          schema:
            default: 1
            type: number
        - name: limit
          required: false
          in: query
          description: Itens por página
          schema:
            default: 20
            type: number
      responses:
        '200':
          description: Lista de certificações
      security: *ref_40
      summary: Listar certificações
      tags: *ref_41
  /certifications/statistics:
    get:
      description: Retorna estatísticas gerais das certificações
      operationId: CertificationController_getStatistics
      parameters: []
      responses:
        '200':
          description: Estatísticas
      security: *ref_40
      summary: Obter estatísticas de certificações
      tags: *ref_41
  /certifications/expiring:
    get:
      description: Lista certificações que expiram nos próximos dias
      operationId: CertificationController_getExpiring
      parameters:
        - name: days
          required: false
          in: query
          description: 'Número de dias para considerar (padrão: 90)'
          schema:
            type: number
      responses:
        '200':
          description: Lista de certificações expirando
      security: *ref_40
      summary: Certificações expirando
      tags: *ref_41
  /certifications/company/{companyId}:
    get:
      description: Lista todas as certificações de uma empresa
      operationId: CertificationController_findByCompany
      parameters:
        - name: companyId
          required: true
          in: path
          description: ID da empresa
          schema:
            type: string
      responses:
        '200':
          description: Lista de certificações
      security: *ref_40
      summary: Certificações por empresa
      tags: *ref_41
  /certifications/{id}:
    get:
      description: Retorna detalhes completos de uma certificação
      operationId: CertificationController_findOne
      parameters:
        - name: id
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
      responses:
        '200':
          description: Detalhes da certificação
        '404':
          description: Certificação não encontrada
      security: *ref_40
      summary: Detalhes da certificação
      tags: *ref_41
    put:
      description: Atualiza dados de uma certificação
      operationId: CertificationController_update
      parameters:
        - name: id
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCertificationDto'
      responses:
        '200':
          description: Certificação atualizada
        '404':
          description: Certificação não encontrada
      security: *ref_40
      summary: Atualizar certificação
      tags: *ref_41
  /certifications/{id}/timeline:
    get:
      description: Retorna o histórico de ações da certificação
      operationId: CertificationController_getTimeline
      parameters:
        - name: id
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
        - name: limit
          required: false
          in: query
          description: 'Limite de registros (padrão: 50)'
          schema:
            type: number
      responses:
        '200':
          description: Timeline da certificação
        '404':
          description: Certificação não encontrada
      security: *ref_40
      summary: Timeline da certificação
      tags: *ref_41
  /certifications/{id}/status:
    patch:
      description: Atualiza o status de uma certificação
      operationId: CertificationController_updateStatus
      parameters:
        - name: id
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
      responses:
        '200':
          description: Status atualizado
        '404':
          description: Certificação não encontrada
      security: *ref_40
      summary: Atualizar status
      tags: *ref_41
  /certifications/{id}/analyst:
    patch:
      description: Atribui um analista à certificação
      operationId: CertificationController_assignAnalyst
      parameters:
        - name: id
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
      responses:
        '200':
          description: Analista atribuído
        '404':
          description: Certificação ou analista não encontrado
      security: *ref_40
      summary: Atribuir analista
      tags: *ref_41
  /certifications/{id}/status-details:
    get:
      description: Retorna detalhes do cálculo de status da certificação
      operationId: CertificationController_getStatusDetails
      parameters:
        - name: id
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
      responses:
        '200':
          description: Detalhes do status
        '404':
          description: Certificação não encontrada
      security: *ref_40
      summary: Detalhes do status
      tags: *ref_41
  /certifications/{id}/recalculate-status:
    patch:
      description: >-
        Recalcula e atualiza o status da certificação baseado nas regras de
        negócio
      operationId: CertificationController_recalculateStatus
      parameters:
        - name: id
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
      responses:
        '200':
          description: Status recalculado
        '404':
          description: Certificação não encontrada
      security: *ref_40
      summary: Recalcular status
      tags: *ref_41
  /certifications/batch-recalculate-status:
    patch:
      description: Recalcula o status de todas as certificações (para jobs agendados)
      operationId: CertificationController_batchRecalculateStatus
      parameters: []
      responses:
        '200':
          description: Resultados do recálculo em lote
      security: *ref_40
      summary: Recalcular status em lote
      tags: *ref_41
  /certifications/{id}/suspend:
    post:
      description: >-
        Suspende uma certificação ativa. Tipo normal: 3 meses. Tipo entressafra:
        1 ano.
      operationId: CertificationController_suspendCertification
      parameters:
        - name: id
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SuspendCertificationDto'
      responses:
        '200':
          description: Certificação suspensa
        '400':
          description: Certificação não pode ser suspensa
        '404':
          description: Certificação não encontrada
      security: *ref_40
      summary: Suspender certificação
      tags: *ref_41
  /certifications/{id}/reactivate:
    post:
      description: Reativa uma certificação suspensa antes do prazo máximo expirar
      operationId: CertificationController_reactivateCertification
      parameters:
        - name: id
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
      responses:
        '200':
          description: Certificação reativada
        '400':
          description: Certificação não pode ser reativada
        '404':
          description: Certificação não encontrada
      security: *ref_40
      summary: Reativar certificação
      tags: *ref_41
  /certifications/{id}/suspension-status:
    get:
      description: Retorna detalhes do status de suspensão de uma certificação
      operationId: CertificationController_getSuspensionStatus
      parameters:
        - name: id
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
      responses:
        '200':
          description: Status de suspensão
        '404':
          description: Certificação não encontrada
      security: *ref_40
      summary: Status de suspensão
      tags: *ref_41
  /certifications/suspensions/expired:
    get:
      description: Lista certificações suspensas cujo prazo máximo expirou
      operationId: CertificationController_getExpiredSuspensions
      parameters: []
      responses:
        '200':
          description: Lista de suspensões expiradas
      security: *ref_40
      summary: Suspensões expiradas
      tags: *ref_41
  /certifications/suspensions/process-expired:
    post:
      description: >-
        Cancela automaticamente certificações suspensas cujo prazo expirou (job
        agendado)
      operationId: CertificationController_processExpiredSuspensions
      parameters: []
      responses:
        '200':
          description: Resultado do processamento
      security: *ref_40
      summary: Processar suspensões expiradas
      tags: *ref_41
  /certifications/{certificationId}/scope:
    get:
      description: Retorna o escopo completo da certificação com todos os itens
      operationId: CertificationScopeController_getScope
      parameters:
        - name: certificationId
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
      responses:
        '200':
          description: Escopo da certificação
        '404':
          description: Escopo não encontrado
      security: &ref_42
        - bearer: []
      summary: Obter escopo completo
      tags: &ref_43
        - certification-scope
    put:
      description: Atualiza descrição, capacidade produtiva, etc.
      operationId: CertificationScopeController_updateScope
      parameters:
        - name: certificationId
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateScopeDto'
      responses:
        '200':
          description: Escopo atualizado
      security: *ref_42
      summary: Atualizar informações gerais do escopo
      tags: *ref_43
  /certifications/{certificationId}/scope/summary:
    get:
      description: Retorna contagem de itens no escopo
      operationId: CertificationScopeController_getScopeSummary
      parameters:
        - name: certificationId
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
      responses:
        '200':
          description: Resumo do escopo
      security: *ref_42
      summary: Resumo do escopo
      tags: *ref_43
  /certifications/{certificationId}/scope/products:
    get:
      operationId: CertificationScopeController_listProducts
      parameters:
        - name: certificationId
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
        - name: includeRemoved
          required: false
          in: query
          description: Incluir produtos removidos
          schema:
            type: boolean
      responses:
        '200':
          description: Lista de produtos
      security: *ref_42
      summary: Listar produtos do escopo
      tags: *ref_43
    post:
      operationId: CertificationScopeController_addProduct
      parameters:
        - name: certificationId
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateScopeProductDto'
      responses:
        '201':
          description: Produto adicionado
      security: *ref_42
      summary: Adicionar produto ao escopo
      tags: *ref_43
  /certifications/{certificationId}/scope/products/{productId}:
    put:
      operationId: CertificationScopeController_updateProduct
      parameters:
        - name: productId
          required: true
          in: path
          description: ID do produto
          schema:
            type: string
        - name: certificationId
          required: true
          in: path
          description: ID da certificação
          schema: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateScopeProductDto'
      responses:
        '200':
          description: Produto atualizado
      security: *ref_42
      summary: Atualizar produto
      tags: *ref_43
    delete:
      operationId: CertificationScopeController_removeProduct
      parameters:
        - name: productId
          required: true
          in: path
          description: ID do produto
          schema:
            type: string
        - name: certificationId
          required: true
          in: path
          description: ID da certificação
          schema: {}
      responses:
        '200':
          description: Produto removido
      security: *ref_42
      summary: Remover produto do escopo
      tags: *ref_43
  /certifications/{certificationId}/scope/facilities:
    get:
      operationId: CertificationScopeController_listFacilities
      parameters:
        - name: certificationId
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
        - name: includeRemoved
          required: false
          in: query
          description: Incluir instalações removidas
          schema:
            type: boolean
      responses:
        '200':
          description: Lista de instalações
      security: *ref_42
      summary: Listar instalações do escopo
      tags: *ref_43
    post:
      operationId: CertificationScopeController_addFacility
      parameters:
        - name: certificationId
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateScopeFacilityDto'
      responses:
        '201':
          description: Instalação adicionada
      security: *ref_42
      summary: Adicionar instalação ao escopo
      tags: *ref_43
  /certifications/{certificationId}/scope/facilities/{facilityId}:
    put:
      operationId: CertificationScopeController_updateFacility
      parameters:
        - name: facilityId
          required: true
          in: path
          description: ID da instalação
          schema:
            type: string
        - name: certificationId
          required: true
          in: path
          description: ID da certificação
          schema: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateScopeFacilityDto'
      responses:
        '200':
          description: Instalação atualizada
      security: *ref_42
      summary: Atualizar instalação
      tags: *ref_43
    delete:
      operationId: CertificationScopeController_removeFacility
      parameters:
        - name: facilityId
          required: true
          in: path
          description: ID da instalação
          schema:
            type: string
        - name: certificationId
          required: true
          in: path
          description: ID da certificação
          schema: {}
      responses:
        '200':
          description: Instalação removida
      security: *ref_42
      summary: Remover instalação do escopo
      tags: *ref_43
  /certifications/{certificationId}/scope/brands:
    get:
      operationId: CertificationScopeController_listBrands
      parameters:
        - name: certificationId
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
        - name: includeRemoved
          required: false
          in: query
          description: Incluir marcas removidas
          schema:
            type: boolean
      responses:
        '200':
          description: Lista de marcas
      security: *ref_42
      summary: Listar marcas do escopo
      tags: *ref_43
    post:
      operationId: CertificationScopeController_addBrand
      parameters:
        - name: certificationId
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateScopeBrandDto'
      responses:
        '201':
          description: Marca adicionada
      security: *ref_42
      summary: Adicionar marca ao escopo
      tags: *ref_43
  /certifications/{certificationId}/scope/brands/{brandId}:
    put:
      operationId: CertificationScopeController_updateBrand
      parameters:
        - name: brandId
          required: true
          in: path
          description: ID da marca
          schema:
            type: string
        - name: certificationId
          required: true
          in: path
          description: ID da certificação
          schema: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateScopeBrandDto'
      responses:
        '200':
          description: Marca atualizada
      security: *ref_42
      summary: Atualizar marca
      tags: *ref_43
    delete:
      operationId: CertificationScopeController_removeBrand
      parameters:
        - name: brandId
          required: true
          in: path
          description: ID da marca
          schema:
            type: string
        - name: certificationId
          required: true
          in: path
          description: ID da certificação
          schema: {}
      responses:
        '200':
          description: Marca removida
      security: *ref_42
      summary: Remover marca do escopo
      tags: *ref_43
  /certifications/{certificationId}/scope/suppliers:
    get:
      operationId: CertificationScopeController_listSuppliers
      parameters:
        - name: certificationId
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
        - name: includeRemoved
          required: false
          in: query
          description: Incluir fornecedores removidos
          schema:
            type: boolean
      responses:
        '200':
          description: Lista de fornecedores
      security: *ref_42
      summary: Listar fornecedores do escopo
      tags: *ref_43
    post:
      operationId: CertificationScopeController_addSupplier
      parameters:
        - name: certificationId
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateScopeSupplierDto'
      responses:
        '201':
          description: Fornecedor adicionado
      security: *ref_42
      summary: Adicionar fornecedor ao escopo
      tags: *ref_43
  /certifications/{certificationId}/scope/suppliers/{supplierId}:
    put:
      operationId: CertificationScopeController_updateSupplier
      parameters:
        - name: supplierId
          required: true
          in: path
          description: ID do fornecedor
          schema:
            type: string
        - name: certificationId
          required: true
          in: path
          description: ID da certificação
          schema: {}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateScopeSupplierDto'
      responses:
        '200':
          description: Fornecedor atualizado
      security: *ref_42
      summary: Atualizar fornecedor
      tags: *ref_43
    delete:
      operationId: CertificationScopeController_removeSupplier
      parameters:
        - name: supplierId
          required: true
          in: path
          description: ID do fornecedor
          schema:
            type: string
        - name: certificationId
          required: true
          in: path
          description: ID da certificação
          schema: {}
      responses:
        '200':
          description: Fornecedor removido
      security: *ref_42
      summary: Remover fornecedor do escopo
      tags: *ref_43
  /certification-requests:
    post:
      description: >-
        Cria uma nova solicitação de certificação (nova, renovação, manutenção
        ou ajuste)
      operationId: CertificationRequestController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCertificationRequestDto'
      responses:
        '201':
          description: Solicitação criada
        '404':
          description: Certificação não encontrada
      security: &ref_44
        - bearer: []
      summary: Criar nova solicitação
      tags: &ref_45
        - certification-requests
    get:
      description: Lista solicitações com filtros e paginação
      operationId: CertificationRequestController_findAll
      parameters:
        - name: certificationId
          required: false
          in: query
          description: ID da certificação
          schema:
            type: string
        - name: requestType
          required: false
          in: query
          description: Tipo da solicitação
          schema:
            type: string
            enum:
              - nova
              - inicial
              - renovacao
              - ampliacao
              - manutencao
              - adequacao
        - name: status
          required: false
          in: query
          description: Status da solicitação
          schema:
            type: string
            enum:
              - rascunho
              - enviado
              - pendente
              - em_analise
              - aprovado
              - rejeitado
              - cancelado
        - name: protocol
          required: false
          in: query
          description: Protocolo
          schema:
            type: string
        - name: page
          required: false
          in: query
          description: Página (inicia em 1)
          schema:
            default: 1
            type: number
        - name: limit
          required: false
          in: query
          description: Itens por página
          schema:
            default: 20
            type: number
      responses:
        '200':
          description: Lista de solicitações
      security: *ref_44
      summary: Listar solicitações
      tags: *ref_45
  /certification-requests/statistics:
    get:
      description: Retorna estatísticas das solicitações
      operationId: CertificationRequestController_getStatistics
      parameters: []
      responses:
        '200':
          description: Estatísticas
      security: *ref_44
      summary: Estatísticas de solicitações
      tags: *ref_45
  /certification-requests/protocol/{protocol}:
    get:
      description: Busca solicitação pelo número de protocolo
      operationId: CertificationRequestController_findByProtocol
      parameters:
        - name: protocol
          required: true
          in: path
          description: Número do protocolo
          schema:
            type: string
      responses:
        '200':
          description: Solicitação encontrada
        '404':
          description: Solicitação não encontrada
      security: *ref_44
      summary: Buscar por protocolo
      tags: *ref_45
  /certification-requests/certification/{certificationId}:
    get:
      description: Lista todas as solicitações de uma certificação
      operationId: CertificationRequestController_findByCertification
      parameters:
        - name: certificationId
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
      responses:
        '200':
          description: Lista de solicitações
      security: *ref_44
      summary: Solicitações por certificação
      tags: *ref_45
  /certification-requests/{id}:
    get:
      description: Retorna detalhes de uma solicitação
      operationId: CertificationRequestController_findOne
      parameters:
        - name: id
          required: true
          in: path
          description: ID da solicitação
          schema:
            type: string
      responses:
        '200':
          description: Detalhes da solicitação
        '404':
          description: Solicitação não encontrada
      security: *ref_44
      summary: Detalhes da solicitação
      tags: *ref_45
    put:
      description: Atualiza dados de uma solicitação em rascunho
      operationId: CertificationRequestController_update
      parameters:
        - name: id
          required: true
          in: path
          description: ID da solicitação
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCertificationRequestDto'
      responses:
        '200':
          description: Solicitação atualizada
        '400':
          description: Solicitação não pode ser atualizada
        '404':
          description: Solicitação não encontrada
      security: *ref_44
      summary: Atualizar solicitação
      tags: *ref_45
  /certification-requests/{id}/submit:
    patch:
      description: Envia solicitação para análise (gera protocolo)
      operationId: CertificationRequestController_submit
      parameters:
        - name: id
          required: true
          in: path
          description: ID da solicitação
          schema:
            type: string
      responses:
        '200':
          description: Solicitação enviada
        '400':
          description: Solicitação não pode ser enviada
      security: *ref_44
      summary: Enviar para análise
      tags: *ref_45
  /certification-requests/{id}/review:
    patch:
      description: Inicia a análise de uma solicitação pendente
      operationId: CertificationRequestController_startReview
      parameters:
        - name: id
          required: true
          in: path
          description: ID da solicitação
          schema:
            type: string
      responses:
        '200':
          description: Análise iniciada
        '400':
          description: Solicitação não pode entrar em análise
      security: *ref_44
      summary: Iniciar análise
      tags: *ref_45
  /certification-requests/{id}/approve:
    patch:
      description: Aprova uma solicitação em análise
      operationId: CertificationRequestController_approve
      parameters:
        - name: id
          required: true
          in: path
          description: ID da solicitação
          schema:
            type: string
      responses:
        '200':
          description: Solicitação aprovada
        '400':
          description: Solicitação não pode ser aprovada
      security: *ref_44
      summary: Aprovar solicitação
      tags: *ref_45
  /certification-requests/{id}/reject:
    patch:
      description: Rejeita uma solicitação em análise
      operationId: CertificationRequestController_reject
      parameters:
        - name: id
          required: true
          in: path
          description: ID da solicitação
          schema:
            type: string
      responses:
        '200':
          description: Solicitação rejeitada
        '400':
          description: Solicitação não pode ser rejeitada
      security: *ref_44
      summary: Rejeitar solicitação
      tags: *ref_45
  /certification-requests/{id}/cancel:
    patch:
      description: Cancela uma solicitação (não pode ser aprovada/rejeitada)
      operationId: CertificationRequestController_cancel
      parameters:
        - name: id
          required: true
          in: path
          description: ID da solicitação
          schema:
            type: string
      responses:
        '200':
          description: Solicitação cancelada
        '400':
          description: Solicitação não pode ser cancelada
      security: *ref_44
      summary: Cancelar solicitação
      tags: *ref_45
  /certificates/verify/{number}:
    get:
      description: Endpoint público para validação de certificado via QR code
      operationId: CertificateController_verify
      parameters:
        - name: number
          required: true
          in: path
          description: Número do certificado
          schema:
            type: string
      responses:
        '200':
          description: Resultado da verificação
      summary: Verificar certificado (público)
      tags: &ref_46
        - Certificates
  /certificates:
    post:
      description: Emite um novo certificado para um processo aprovado
      operationId: CertificateController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCertificateDto'
      responses:
        '201':
          description: Certificado emitido
        '400':
          description: Processo não está na fase correta
        '404':
          description: Processo não encontrado
      security:
        - bearer: []
      summary: Emitir certificado
      tags: *ref_46
    get:
      description: Lista certificados com filtros e paginação
      operationId: CertificateController_findAll
      parameters:
        - name: certificationId
          required: false
          in: query
          description: Filter by certification ID
          schema:
            type: string
        - name: processId
          required: false
          in: query
          description: Filter by process ID
          schema:
            type: string
        - name: status
          required: false
          in: query
          description: Filter by status
          schema:
            type: string
            enum:
              - ativo
              - suspenso
              - cancelado
              - expirado
        - name: certificateNumber
          required: false
          in: query
          description: Search by certificate number
          schema:
            type: string
        - name: page
          required: false
          in: query
          description: 'Page number (default: 1)'
          schema:
            default: 1
            type: number
        - name: limit
          required: false
          in: query
          description: 'Items per page (default: 20, max: 100)'
          schema:
            default: 20
            type: number
      responses:
        '200':
          description: Lista de certificados
      security:
        - bearer: []
      summary: Listar certificados
      tags: *ref_46
  /certificates/statistics:
    get:
      description: Retorna estatísticas dos certificados
      operationId: CertificateController_getStatistics
      parameters: []
      responses:
        '200':
          description: Estatísticas
      security:
        - bearer: []
      summary: Estatísticas de certificados
      tags: *ref_46
  /certificates/expiring:
    get:
      description: Lista certificados que vencem nos próximos N dias
      operationId: CertificateController_getExpiringSoon
      parameters:
        - name: daysAhead
          required: false
          in: query
          description: 'Dias à frente (padrão: 90)'
          schema:
            type: number
      responses:
        '200':
          description: Certificados expirando
      security:
        - bearer: []
      summary: Certificados próximos do vencimento
      tags: *ref_46
  /certificates/certification/{certificationId}:
    get:
      description: Lista todos os certificados de uma certificação
      operationId: CertificateController_findByCertificationId
      parameters:
        - name: certificationId
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
      responses:
        '200':
          description: Lista de certificados
      security:
        - bearer: []
      summary: Certificados por certificação
      tags: *ref_46
  /certificates/number/{number}:
    get:
      description: Busca certificado pelo número
      operationId: CertificateController_findByNumber
      parameters:
        - name: number
          required: true
          in: path
          description: Número do certificado
          schema:
            type: string
      responses:
        '200':
          description: Certificado encontrado
        '404':
          description: Certificado não encontrado
      security:
        - bearer: []
      summary: Buscar por número
      tags: *ref_46
  /certificates/{id}:
    get:
      description: Retorna detalhes de um certificado
      operationId: CertificateController_findOne
      parameters:
        - name: id
          required: true
          in: path
          description: ID do certificado
          schema:
            type: string
      responses:
        '200':
          description: Certificado encontrado
        '404':
          description: Certificado não encontrado
      security:
        - bearer: []
      summary: Detalhes do certificado
      tags: *ref_46
    patch:
      description: Atualiza dados do certificado (status, validade, URLs)
      operationId: CertificateController_update
      parameters:
        - name: id
          required: true
          in: path
          description: ID do certificado
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCertificateDto'
      responses:
        '200':
          description: Certificado atualizado
        '404':
          description: Certificado não encontrado
      security:
        - bearer: []
      summary: Atualizar certificado
      tags: *ref_46
  /certificates/{id}/suspend:
    patch:
      description: Suspende temporariamente um certificado ativo
      operationId: CertificateController_suspend
      parameters:
        - name: id
          required: true
          in: path
          description: ID do certificado
          schema:
            type: string
      responses:
        '200':
          description: Certificado suspenso
        '400':
          description: Certificado não está ativo
        '404':
          description: Certificado não encontrado
      security:
        - bearer: []
      summary: Suspender certificado
      tags: *ref_46
  /certificates/{id}/reactivate:
    patch:
      description: Reativa um certificado suspenso
      operationId: CertificateController_reactivate
      parameters:
        - name: id
          required: true
          in: path
          description: ID do certificado
          schema:
            type: string
      responses:
        '200':
          description: Certificado reativado
        '400':
          description: Certificado não está suspenso ou expirado
        '404':
          description: Certificado não encontrado
      security:
        - bearer: []
      summary: Reativar certificado
      tags: *ref_46
  /certificates/{id}/cancel:
    patch:
      description: Cancela permanentemente um certificado
      operationId: CertificateController_cancel
      parameters:
        - name: id
          required: true
          in: path
          description: ID do certificado
          schema:
            type: string
      responses:
        '200':
          description: Certificado cancelado
        '400':
          description: Certificado já está cancelado
        '404':
          description: Certificado não encontrado
      security:
        - bearer: []
      summary: Cancelar certificado
      tags: *ref_46
  /workflows:
    get:
      description: Lista workflows com filtros e paginação
      operationId: WorkflowController_findAll
      parameters:
        - name: status
          required: false
          in: query
          schema:
            enum:
              - rascunho
              - pendente
              - em_andamento
              - aguardando_documentos
              - aguardando_empresa
              - aguardando_auditoria
              - em_auditoria
              - aguardando_comite
              - concluido
              - cancelado
              - suspenso
            type: string
        - name: currentPhase
          required: false
          in: query
          schema:
            enum:
              - cadastro_solicitacao
              - analise_documental_inicial
              - elaboracao_proposta
              - negociacao_proposta
              - proposta_aprovada
              - elaboracao_contrato
              - assinatura_contrato
              - avaliacao_documental
              - planejamento_auditoria
              - auditoria_estagio1
              - auditoria_estagio2
              - analise_nao_conformidades
              - correcao_nao_conformidades
              - validacao_correcoes
              - comite_tecnico
              - emissao_certificado
              - certificado_emitido
            type: string
        - name: analystId
          required: false
          in: query
          schema:
            type: string
        - name: auditorId
          required: false
          in: query
          schema:
            type: string
        - name: page
          required: false
          in: query
          schema:
            type: number
        - name: limit
          required: false
          in: query
          schema:
            type: number
      responses:
        '200':
          description: Lista de workflows
      security: &ref_47
        - bearer: []
      summary: Listar workflows
      tags: &ref_48
        - Workflows
  /workflows/statistics:
    get:
      description: Retorna estatísticas dos workflows
      operationId: WorkflowController_getStatistics
      parameters: []
      responses:
        '200':
          description: Estatísticas
      security: *ref_47
      summary: Estatísticas de workflows
      tags: *ref_48
  /workflows/flow/{requestType}:
    get:
      description: Retorna as fases e regras do fluxo baseado no tipo de solicitação
      operationId: WorkflowController_getFlowInfo
      parameters:
        - name: requestType
          required: true
          in: path
          description: Tipo de solicitação (nova, renovacao, ampliacao, etc.)
          schema:
            enum:
              - nova
              - inicial
              - renovacao
              - ampliacao
              - manutencao
              - adequacao
            type: string
      responses:
        '200':
          description: Informações do fluxo
      security: *ref_47
      summary: Informações do fluxo por tipo
      tags: *ref_48
  /workflows/request/{requestId}:
    get:
      description: Retorna o workflow de uma solicitação
      operationId: WorkflowController_findByRequestId
      parameters:
        - name: requestId
          required: true
          in: path
          description: ID da solicitação
          schema:
            type: string
      responses:
        '200':
          description: Workflow encontrado
        '404':
          description: Workflow não encontrado
      security: *ref_47
      summary: Buscar por solicitação
      tags: *ref_48
  /workflows/{id}:
    get:
      description: Retorna detalhes de um workflow
      operationId: WorkflowController_findOne
      parameters:
        - name: id
          required: true
          in: path
          description: ID do workflow
          schema:
            type: string
      responses:
        '200':
          description: Workflow encontrado
        '404':
          description: Workflow não encontrado
      security: *ref_47
      summary: Detalhes do workflow
      tags: *ref_48
    patch:
      description: Atualiza status, fase ou prioridade do workflow
      operationId: WorkflowController_update
      parameters:
        - name: id
          required: true
          in: path
          description: ID do workflow
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateWorkflowDto'
      responses:
        '200':
          description: Workflow atualizado
        '404':
          description: Workflow não encontrado
      security: *ref_47
      summary: Atualizar workflow
      tags: *ref_48
  /workflows/{id}/next-phases:
    get:
      description: Retorna as fases válidas para transição baseado no tipo de solicitação
      operationId: WorkflowController_getNextPhases
      parameters:
        - name: id
          required: true
          in: path
          description: ID do workflow
          schema:
            type: string
      responses:
        '200':
          description: Fases válidas
        '404':
          description: Workflow não encontrado
      security: *ref_47
      summary: Próximas fases válidas
      tags: *ref_48
  /workflows/{id}/assign-analyst:
    patch:
      description: Atribui um analista ao workflow e avança para análise documental
      operationId: WorkflowController_assignAnalyst
      parameters:
        - name: id
          required: true
          in: path
          description: ID do workflow
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssignAnalystToWorkflowDto'
      responses:
        '200':
          description: Analista atribuído
        '400':
          description: Usuário não é analista
        '404':
          description: Workflow ou analista não encontrado
      security: *ref_47
      summary: Atribuir analista
      tags: *ref_48
  /workflows/{id}/assign-auditor:
    patch:
      description: Atribui um auditor ao workflow
      operationId: WorkflowController_assignAuditor
      parameters:
        - name: id
          required: true
          in: path
          description: ID do workflow
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssignAuditorToWorkflowDto'
      responses:
        '200':
          description: Auditor atribuído
        '400':
          description: Usuário não é auditor
        '404':
          description: Workflow ou auditor não encontrado
      security: *ref_47
      summary: Atribuir auditor
      tags: *ref_48
  /workflows/{id}/advance:
    patch:
      description: Avança o workflow para a próxima fase (valida transição e permissões)
      operationId: WorkflowController_advancePhase
      parameters:
        - name: id
          required: true
          in: path
          description: ID do workflow
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdvancePhaseDto'
      responses:
        '200':
          description: Fase avançada
        '400':
          description: Transição inválida
        '403':
          description: Sem permissão para esta fase
        '404':
          description: Workflow não encontrado
      security: *ref_47
      summary: Avançar fase
      tags: *ref_48
  /workflows/{id}/reject:
    post:
      description: |-
        Rejeita a solicitação no comitê técnico. O resultado depende do tipo:
            - Nova/Inicial: Certificação marcada como recusada
            - Manutenção: Certificação suspensa por 3 meses
            - Renovação: Certificado atual expira normalmente
      operationId: WorkflowController_rejectAtCommittee
      parameters:
        - name: id
          required: true
          in: path
          description: ID do workflow
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RejectAtCommitteeDto'
      responses:
        '200':
          description: Solicitação rejeitada
        '400':
          description: Workflow não está na fase de comitê
        '404':
          description: Workflow não encontrado
      security: *ref_47
      summary: Rejeitar no comitê
      tags: *ref_48
  /workflows/{id}/rejection-outcome:
    get:
      description: Retorna o que acontecerá se a solicitação for rejeitada no comitê
      operationId: WorkflowController_getRejectionOutcome
      parameters:
        - name: id
          required: true
          in: path
          description: ID do workflow
          schema:
            type: string
      responses:
        '200':
          description: Previsão do resultado
        '404':
          description: Workflow não encontrado
      security: *ref_47
      summary: Prever resultado da rejeição
      tags: *ref_48
  /workflows/certifications/{certificationId}/cancel:
    post:
      description: |-
        Cancela uma certificação. Regras PR 7.1 Rev. 22:
            - pos_suspensao: Só pode cancelar após período de suspensão
            - distrato: Cancelamento direto por rescisão contratual
      operationId: WorkflowController_cancelCertification
      parameters:
        - name: certificationId
          required: true
          in: path
          description: ID da certificação
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CancelCertificationDto'
      responses:
        '200':
          description: Certificação cancelada
        '400':
          description: Violação das regras de cancelamento
        '404':
          description: Certificação não encontrada
      security: *ref_47
      summary: Cancelar certificação
      tags: *ref_48
  /invites:
    post:
      description: Envia um convite para um email ingressar na empresa
      operationId: UserInviteController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateInviteDto'
      responses:
        '201':
          description: Convite criado
        '404':
          description: Empresa não encontrada
        '409':
          description: Email já cadastrado ou convite pendente
      security:
        - bearer: []
      summary: Criar convite
      tags: &ref_49
        - User Invites
    get:
      description: Lista convites com filtros opcionais
      operationId: UserInviteController_findAll
      parameters:
        - name: companyId
          required: false
          in: query
          description: Filter by company ID
          schema:
            type: string
        - name: status
          required: false
          in: query
          description: Filter by invite status
          schema:
            enum:
              - pending
              - accepted
              - expired
              - cancelled
            type: string
        - name: search
          required: false
          in: query
          description: Search by email
          schema:
            type: string
        - name: skip
          required: false
          in: query
          description: Number of records to skip
          schema:
            type: number
        - name: take
          required: false
          in: query
          description: Number of records to return
          schema:
            type: number
      responses:
        '200':
          description: Lista de convites
      security:
        - bearer: []
      summary: Listar convites
      tags: *ref_49
  /invites/validate/{token}:
    get:
      description: Verifica se um token de convite é válido
      operationId: UserInviteController_validateToken
      parameters:
        - name: token
          required: true
          in: path
          description: Token do convite
          schema:
            type: string
      responses:
        '200':
          description: Token válido, retorna dados do convite
        '400':
          description: Token expirado ou já utilizado
        '404':
          description: Convite não encontrado
      summary: Validar token do convite
      tags: *ref_49
  /invites/{token}/accept:
    post:
      description: Aceita o convite e cria a conta do usuário
      operationId: UserInviteController_acceptInvite
      parameters:
        - name: token
          required: true
          in: path
          description: Token do convite
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AcceptInviteDto'
      responses:
        '201':
          description: Convite aceito, conta criada
        '400':
          description: Token expirado ou já utilizado
        '404':
          description: Convite não encontrado
        '409':
          description: Email já cadastrado
      summary: Aceitar convite
      tags: *ref_49
  /invites/company/{companyId}/stats:
    get:
      description: Retorna contagem de convites por status para uma empresa
      operationId: UserInviteController_getStatsByCompany
      parameters:
        - name: companyId
          required: true
          in: path
          description: ID da empresa
          schema:
            type: string
      responses:
        '200':
          description: Estatísticas
      security:
        - bearer: []
      summary: Estatísticas de convites por empresa
      tags: *ref_49
  /invites/company/{companyId}/pending:
    get:
      description: Lista convites pendentes (não expirados) de uma empresa
      operationId: UserInviteController_findPendingByCompany
      parameters:
        - name: companyId
          required: true
          in: path
          description: ID da empresa
          schema:
            type: string
      responses:
        '200':
          description: Lista de convites pendentes
      security:
        - bearer: []
      summary: Convites pendentes por empresa
      tags: *ref_49
  /invites/{id}/resend:
    post:
      description: Gera novo token e data de expiração para o convite
      operationId: UserInviteController_resend
      parameters:
        - name: id
          required: true
          in: path
          description: ID do convite
          schema:
            type: string
      responses:
        '200':
          description: Convite reenviado
        '400':
          description: Convite já aceito
        '404':
          description: Convite não encontrado
      security:
        - bearer: []
      summary: Reenviar convite
      tags: *ref_49
  /invites/{id}:
    delete:
      description: Cancela um convite pendente
      operationId: UserInviteController_cancel
      parameters:
        - name: id
          required: true
          in: path
          description: ID do convite
          schema:
            type: string
      responses:
        '200':
          description: Convite cancelado
        '400':
          description: Convite não está pendente
        '404':
          description: Convite não encontrado
      security:
        - bearer: []
      summary: Cancelar convite
      tags: *ref_49
  /access-requests:
    post:
      description: Usuário solicita acesso a uma empresa existente (encontrada por CNPJ)
      operationId: AccessRequestController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAccessRequestDto'
      responses:
        '201':
          description: Solicitação criada
        '404':
          description: Empresa não encontrada
        '409':
          description: Já existe solicitação ou usuário já vinculado
      security: &ref_50
        - bearer: []
      summary: Solicitar acesso a empresa
      tags: &ref_51
        - Access Requests
    get:
      description: Lista todas as solicitações de acesso com filtros
      operationId: AccessRequestController_findAll
      parameters:
        - name: companyId
          required: false
          in: query
          description: Filter by company ID
          schema:
            type: string
        - name: userId
          required: false
          in: query
          description: Filter by user ID
          schema:
            type: string
        - name: status
          required: false
          in: query
          description: Filter by request status
          schema:
            enum:
              - pending
              - approved
              - rejected
            type: string
        - name: skip
          required: false
          in: query
          description: Number of records to skip
          schema:
            type: number
        - name: take
          required: false
          in: query
          description: Number of records to return
          schema:
            type: number
      responses:
        '200':
          description: Lista de solicitações
      security: *ref_50
      summary: Listar solicitações de acesso
      tags: *ref_51
  /access-requests/stats:
    get:
      description: Contagem de solicitações por status
      operationId: AccessRequestController_getStats
      parameters: []
      responses:
        '200':
          description: Estatísticas
      security: *ref_50
      summary: Estatísticas de solicitações
      tags: *ref_51
  /access-requests/my:
    get:
      description: Lista as solicitações de acesso do usuário logado
      operationId: AccessRequestController_findMyRequests
      parameters: []
      responses:
        '200':
          description: Lista de solicitações
      security: *ref_50
      summary: Minhas solicitações
      tags: *ref_51
  /access-requests/company/{companyId}/pending:
    get:
      description: Lista solicitações pendentes para uma empresa específica
      operationId: AccessRequestController_findPendingByCompany
      parameters:
        - name: companyId
          required: true
          in: path
          description: ID da empresa
          schema:
            type: string
      responses:
        '200':
          description: Lista de solicitações pendentes
      security: *ref_50
      summary: Solicitações pendentes por empresa
      tags: *ref_51
  /access-requests/{id}/approve:
    post:
      description: Aprova a solicitação e vincula o usuário à empresa
      operationId: AccessRequestController_approve
      parameters:
        - name: id
          required: true
          in: path
          description: ID da solicitação
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RespondAccessRequestDto'
      responses:
        '200':
          description: Solicitação aprovada
        '400':
          description: Solicitação não está pendente
        '404':
          description: Solicitação não encontrada
        '409':
          description: Usuário já vinculado ou empresa já tem usuário
      security: *ref_50
      summary: Aprovar solicitação
      tags: *ref_51
  /access-requests/{id}/reject:
    post:
      description: Rejeita a solicitação de acesso
      operationId: AccessRequestController_reject
      parameters:
        - name: id
          required: true
          in: path
          description: ID da solicitação
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RespondAccessRequestDto'
      responses:
        '200':
          description: Solicitação rejeitada
        '400':
          description: Solicitação não está pendente
        '404':
          description: Solicitação não encontrada
      security: *ref_50
      summary: Rejeitar solicitação
      tags: *ref_51
  /access-requests/my/{id}:
    delete:
      description: Cancela uma solicitação pendente do usuário logado
      operationId: AccessRequestController_cancelMyRequest
      parameters:
        - name: id
          required: true
          in: path
          description: ID da solicitação
          schema:
            type: string
      responses:
        '200':
          description: Solicitação cancelada
        '400':
          description: Solicitação não está pendente
        '403':
          description: Solicitação não pertence ao usuário
        '404':
          description: Solicitação não encontrada
      security: *ref_50
      summary: Cancelar minha solicitação
      tags: *ref_51
  /access-requests/{id}:
    get:
      description: Retorna detalhes de uma solicitação específica
      operationId: AccessRequestController_findById
      parameters:
        - name: id
          required: true
          in: path
          description: ID da solicitação
          schema:
            type: string
      responses:
        '200':
          description: Solicitação encontrada
        '404':
          description: Solicitação não encontrada
      security: *ref_50
      summary: Obter solicitação por ID
      tags: *ref_51
  /ai/chat:
    post:
      description: Send messages to AI for conversational certification assistance
      operationId: AiController_chatCompletion
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatCompletionDto'
      responses:
        '200':
          description: Chat response received
        '400':
          description: Invalid input
        '500':
          description: AI processing error
      security: &ref_52
        - access-token: []
      summary: Chat completion
      tags: &ref_53
        - AI
  /ai/extract:
    post:
      description: Extract structured data from conversation history
      operationId: AiController_extractData
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExtractDataDto'
      responses:
        '200':
          description: Data extracted successfully
        '400':
          description: Invalid input
      security: *ref_52
      summary: Extract structured data
      tags: *ref_53
  /ai/suggest-questions:
    post:
      description: Get AI suggestions for next questions based on conversation
      operationId: AiController_suggestQuestions
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SuggestQuestionsDto'
      responses:
        '200':
          description: Questions suggested
      security: *ref_52
      summary: Suggest next questions
      tags: *ref_53
  /ai/validate:
    post:
      description: Validate certification request data using AI
      operationId: AiController_validateData
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValidateDataDto'
      responses:
        '200':
          description: Validation complete
        '400':
          description: Invalid input
      security: *ref_52
      summary: Validate form data
      tags: *ref_53
  /e-signature-config:
    get:
      operationId: ESignatureConfigController_list
      parameters: []
      responses:
        '200':
          description: List of configurations
      security: &ref_54
        - access-token: []
      summary: List all e-signature configurations
      tags: &ref_55
        - E-Signature Config
    post:
      operationId: ESignatureConfigController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateESignatureConfigDto'
      responses:
        '201':
          description: Configuration created
        '400':
          description: Invalid input
      security: *ref_54
      summary: Create new e-signature configuration
      tags: *ref_55
  /e-signature-config/active:
    get:
      operationId: ESignatureConfigController_getActive
      parameters: []
      responses:
        '200':
          description: Active configuration
        '404':
          description: No active configuration found
      security: *ref_54
      summary: Get active e-signature configuration
      tags: *ref_55
  /e-signature-config/{id}:
    patch:
      operationId: ESignatureConfigController_update
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateESignatureConfigDto'
      responses:
        '200':
          description: Configuration updated
        '404':
          description: Configuration not found
      security: *ref_54
      summary: Update e-signature configuration
      tags: *ref_55
    delete:
      operationId: ESignatureConfigController_delete
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Configuration deleted
        '400':
          description: Cannot delete active configuration
        '404':
          description: Configuration not found
      security: *ref_54
      summary: Delete e-signature configuration
      tags: *ref_55
  /e-signature-config/{id}/activate:
    post:
      operationId: ESignatureConfigController_activate
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Configuration activated
        '404':
          description: Configuration not found
      security: *ref_54
      summary: Activate a specific configuration
      tags: *ref_55
  /e-signature-config/test:
    post:
      operationId: ESignatureConfigController_testCredentials
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateESignatureConfigDto'
      responses:
        '200':
          description: Credentials valid
        '401':
          description: Credentials invalid
      security: *ref_54
      summary: Test e-signature credentials
      tags: *ref_55
  /storage-config:
    get:
      operationId: StorageConfigController_listConfigs
      parameters: []
      responses:
        '200':
          description: List of configurations
      security: &ref_56
        - access-token: []
      summary: List all storage configurations
      tags: &ref_57
        - Storage Config
    post:
      operationId: StorageConfigController_createConfig
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateStorageConfigDto'
      responses:
        '201':
          description: Configuration created
        '400':
          description: Invalid input
      security: *ref_56
      summary: Create new storage configuration
      tags: *ref_57
  /storage-config/active:
    get:
      operationId: StorageConfigController_getActiveConfig
      parameters: []
      responses:
        '200':
          description: Active configuration
        '404':
          description: No active configuration found
      security: *ref_56
      summary: Get active storage configuration
      tags: *ref_57
  /storage-config/{configId}:
    patch:
      operationId: StorageConfigController_updateConfig
      parameters:
        - name: configId
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateStorageConfigDto'
      responses:
        '200':
          description: Configuration updated
        '404':
          description: Configuration not found
      security: *ref_56
      summary: Update storage configuration
      tags: *ref_57
    delete:
      operationId: StorageConfigController_deleteConfig
      parameters:
        - name: configId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Configuration deleted
        '400':
          description: Cannot delete active configuration
        '404':
          description: Configuration not found
      security: *ref_56
      summary: Delete storage configuration
      tags: *ref_57
  /storage-config/{configId}/activate:
    post:
      operationId: StorageConfigController_activateConfig
      parameters:
        - name: configId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Configuration activated
        '404':
          description: Configuration not found
      security: *ref_56
      summary: Activate a specific storage configuration
      tags: *ref_57
  /storage-config/{configId}/test:
    post:
      operationId: StorageConfigController_testConfig
      parameters:
        - name: configId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Connection test result
        '404':
          description: Configuration not found
      security: *ref_56
      summary: Test storage connection
      tags: *ref_57
  /storage-config/buckets:
    get:
      operationId: StorageConfigController_listCompanyBuckets
      parameters: []
      responses:
        '200':
          description: List of company buckets
      security: *ref_56
      summary: List all company buckets
      tags: *ref_57
  /storage-config/buckets/{companyId}/stats:
    get:
      operationId: StorageConfigController_getCompanyBucketStats
      parameters:
        - name: companyId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Bucket statistics
        '404':
          description: Company bucket not found
      security: *ref_56
      summary: Get company bucket statistics
      tags: *ref_57
  /health:
    get:
      operationId: HealthController_check
      parameters: []
      responses:
        '200':
          description: The Health Check is successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  info:
                    type: object
                    example: &ref_58
                      database: &ref_59
                        status: up
                    additionalProperties:
                      type: object
                      required:
                        - status
                      properties:
                        status:
                          type: string
                      additionalProperties: true
                    nullable: true
                  error:
                    type: object
                    example: {}
                    additionalProperties:
                      type: object
                      required:
                        - status
                      properties:
                        status:
                          type: string
                      additionalProperties: true
                    nullable: true
                  details:
                    type: object
                    example: *ref_58
                    additionalProperties:
                      type: object
                      required:
                        - status
                      properties:
                        status:
                          type: string
                      additionalProperties: true
        '503':
          description: The Health Check is not successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: error
                  info:
                    type: object
                    example: *ref_58
                    additionalProperties:
                      type: object
                      required:
                        - status
                      properties:
                        status:
                          type: string
                      additionalProperties: true
                    nullable: true
                  error:
                    type: object
                    example:
                      redis: &ref_60
                        status: down
                        message: Could not connect
                    additionalProperties:
                      type: object
                      required:
                        - status
                      properties:
                        status:
                          type: string
                      additionalProperties: true
                    nullable: true
                  details:
                    type: object
                    example:
                      database: *ref_59
                      redis: *ref_60
                    additionalProperties:
                      type: object
                      required:
                        - status
                      properties:
                        status:
                          type: string
                      additionalProperties: true
      summary: Health check endpoint
      tags: &ref_61
        - Health
  /health/live:
    get:
      operationId: HealthController_getLiveness
      parameters: []
      responses:
        '200':
          description: Service is alive
      summary: Liveness probe
      tags: *ref_61
  /health/ready:
    get:
      operationId: HealthController_getReadiness
      parameters: []
      responses:
        '200':
          description: Service is ready
      summary: Readiness probe
      tags: *ref_61
info:
  title: HalalSphere API
  description: >
    Sistema de Gestão de Certificação Halal


    ## Overview


    HalalSphere is a comprehensive halal certification management system that
    streamlines the entire certification lifecycle from initial request to
    certificate issuance.


    ## Key Features


    - **Request Management**: Handle certification requests from companies

    - **Process Workflow**: Multi-phase process management (documentation,
    proposal, contract, audit, certificate)

    - **Auditor Allocation**: Intelligent auditor assignment and workload
    management

    - **Document Management**: Upload and track certification documents

    - **Contract Management**: Handle contract lifecycle (draft, send,
    negotiate, sign)

    - **Audit Management**: Manage on-site audits and results

    - **Certificate Issuance**: Generate and track halal certificates

    - **Comment System**: Internal and external communication


    ## Authentication


    All endpoints (except health check) require JWT authentication.


    1. Obtain JWT token via `/auth/login`

    2. Include token in Authorization header: `Bearer <token>`

    3. Token contains user ID, email, role, and company ID


    ## User Roles


    - **admin**: Full system access

    - **gestor**: Manager access (allocate auditors, approve processes)

    - **analista**: Analyst access (manage requests, processes, documents)

    - **auditor**: Auditor access (conduct audits, view assigned processes)

    - **empresa**: Company access (view own processes, upload documents)


    ## Process Phases


    1. **analise_documentacao**: Initial document review

    2. **proposta_comercial**: Commercial proposal

    3. **assinatura_contrato**: Contract signing

    4. **planejamento_auditoria**: Audit planning

    5. **execucao_auditoria**: Audit execution

    6. **emissao_certificado**: Certificate issuance


    ## Rate Limiting


    API implements rate limiting to prevent abuse. Default limits:

    - 100 requests per minute per IP

    - 1000 requests per hour per user


    ## Versioning


    Current version: 2.0.0 (NestJS Migration)

    Previous version: 1.x (Express Legacy)
  version: 2.0.0
  contact:
    name: HalalSphere Support
    url: https://halalsphere.com
    email: support@halalsphere.com
  license:
    name: Proprietary
    url: https://halalsphere.com/license
tags:
  - name: Authentication
    description: User authentication and authorization
  - name: Requests
    description: Certification request management
  - name: Process
    description: Process lifecycle management
  - name: Contracts
    description: Contract workflow management
  - name: Auditor Allocation
    description: Auditor assignment and workload
  - name: Audits
    description: Audit execution and management
  - name: Documents
    description: Document upload and management
  - name: Document Requests
    description: Request additional documents from companies
  - name: Proposals
    description: Commercial proposal management
  - name: Certificates
    description: Certificate generation and management
  - name: Comments
    description: Internal and external communication
  - name: Companies
    description: Company management
  - name: Users
    description: User management
  - name: Health
    description: System health and status
servers:
  - url: http://localhost:3333
    description: Local Development
  - url: https://api-staging.halalsphere.com
    description: Staging Environment
  - url: https://api.halalsphere.com
    description: Production Environment
components:
  securitySchemes:
    access-token:
      scheme: bearer
      bearerFormat: JWT
      type: http
      description: 'JWT Authorization token. Example: "Bearer {token}"'
      in: header
  schemas:
    LoginDto:
      type: object
      properties:
        email:
          type: string
          example: usuario@example.com
          description: Email do usuário
        password:
          type: string
          example: senha123
          description: Senha do usuário
          minLength: 6
      required:
        - email
        - password
    LoginResponseDto:
      type: object
      properties: {}
    CompanyAddressDto:
      type: object
      properties:
        cep:
          type: string
        cidade:
          type: string
        uf:
          type: string
        logradouro:
          type: string
        numero:
          type: string
        complemento:
          type: string
        bairro:
          type: string
        pais:
          type: string
          default: Brasil
      required:
        - cep
        - cidade
        - uf
        - pais
    CompanyContactDto:
      type: object
      properties:
        email:
          type: string
        telefone:
          type: string
        whatsapp:
          type: string
        responsavel:
          type: string
      required:
        - email
        - telefone
        - responsavel
    CompanyDataDto:
      type: object
      properties:
        cnpj:
          type: string
        razaoSocial:
          type: string
        nomeFantasia:
          type: string
        address:
          $ref: '#/components/schemas/CompanyAddressDto'
        contact:
          $ref: '#/components/schemas/CompanyContactDto'
        website:
          type: string
        numEmployees:
          type: number
        annualRevenue:
          type: number
        mainActivity:
          type: string
      required:
        - cnpj
        - razaoSocial
        - address
        - contact
    CreateUserDto:
      type: object
      properties:
        email:
          type: string
          example: usuario@example.com
        password:
          type: string
          example: senha123
          minLength: 6
        name:
          type: string
          example: João da Silva
          minLength: 3
        phone:
          type: string
          example: +55 11 98765-4321
        role:
          type: string
          enum: &ref_62
            - admin
            - empresa
            - analista
            - auditor
            - gestor
            - comercial
            - juridico
            - financeiro
            - gestor_auditoria
            - supervisor
            - controlador
            - secretaria
          example: empresa
        companyData:
          $ref: '#/components/schemas/CompanyDataDto'
      required:
        - email
        - password
        - name
        - role
    UpdateUserDto:
      type: object
      properties:
        email:
          type: string
          example: usuario@example.com
        password:
          type: string
          example: senha123
          minLength: 6
        name:
          type: string
          example: João da Silva
          minLength: 3
        phone:
          type: string
          example: +55 11 98765-4321
        role:
          type: string
          enum: *ref_62
          example: empresa
        mfaEnabled:
          type: boolean
        loginAttempts:
          type: number
        lockedUntil:
          type: object
        isGroupAdmin:
          type: boolean
          description: User is admin of their group (can see all companies)
        isCompanyAdmin:
          type: boolean
          description: User is admin of their company
        isTemporaryAdmin:
          type: boolean
          description: User is temporary admin (first user to register company)
    AssignAdminDto:
      type: object
      properties:
        isCompanyAdmin:
          type: boolean
          description: >-
            Designate user as company admin (manages users and settings for
            their company)
          example: true
        isGroupAdmin:
          type: boolean
          description: Designate user as group admin (can see all companies in the group)
          example: false
        reason:
          type: string
          description: Reason for the admin assignment (for audit trail)
          example: Designated as primary contact for company
      required:
        - isCompanyAdmin
    CreateRequestDto:
      type: object
      properties:
        companyId:
          type: string
          description: Company ID
          format: uuid
        companyName:
          type: string
          description: Company name
          maxLength: 255
        contactPerson:
          type: string
          description: Contact person name
          maxLength: 255
        contactEmail:
          type: string
          description: Contact email
          format: email
          example: contact@company.com
        contactPhone:
          type: string
          description: Contact phone number
          example: +55 11 99999-9999
        requestType:
          type: string
          description: Request type
          enum: &ref_63
            - nova
            - inicial
            - renovacao
            - ampliacao
            - manutencao
            - adequacao
          example: nova
        certificationType:
          type: string
          description: Certification type
          enum: &ref_64
            - C1
            - C2
            - C3
            - C4
            - C5
            - C6
            - produto
            - processo
            - servico
          example: C1
        productDescription:
          type: string
          description: Product description
          example: Halal certified frozen chicken products
        productIngredients:
          type: string
          description: Product ingredients list
          example: Chicken, salt, spices
        facilityAddress:
          type: string
          description: Facility address
          example: Rua Example, 123
        facilityCity:
          type: string
          description: Facility city
          maxLength: 100
          example: São Paulo
        facilityState:
          type: string
          description: Facility state
          maxLength: 50
          example: SP
        facilityCountry:
          type: string
          description: Facility country
          maxLength: 50
          example: Brasil
        facilityPostalCode:
          type: string
          description: Facility postal code
          maxLength: 20
          example: 01234-567
        previousCertificates:
          type: boolean
          description: Has previous Halal certificates
          default: false
        certifyingBody:
          type: string
          description: Previous certifying body name
          maxLength: 255
          example: Islamic Certification Body
        certificateNumber:
          type: string
          description: Previous certificate number
          maxLength: 100
          example: HALAL-2023-001
        certificateExpiry:
          format: date-time
          type: string
          description: Previous certificate expiry date
          example: '2025-12-31T23:59:59Z'
        industrialGroupId:
          type: string
          description: Industrial group ID
          format: uuid
        industrialCategoryId:
          type: string
          description: Industrial category ID
          format: uuid
        industrialSubcategoryId:
          type: string
          description: Industrial subcategory ID
          format: uuid
        numberOfEmployees:
          type: number
          description: Number of employees
          minimum: 1
          example: 50
        annualProduction:
          type: string
          description: Annual production volume
          example: 1000 tons/year
        rawMaterialSuppliers:
          type: number
          description: Number of raw material suppliers
          minimum: 0
          example: 10
        additionalInfo:
          type: string
          description: Additional information
          example: We follow strict Halal guidelines in all processes
      required:
        - companyId
        - companyName
        - contactPerson
        - contactEmail
        - contactPhone
        - requestType
        - certificationType
        - productDescription
        - facilityAddress
        - facilityCity
        - facilityState
        - facilityCountry
        - facilityPostalCode
    ApproveRequestDto:
      type: object
      properties:
        reviewNotes:
          type: string
          description: Review notes from analyst
          example: All documentation is complete and valid. Approved for processing.
    RejectRequestDto:
      type: object
      properties:
        rejectionReason:
          type: string
          description: Reason for rejection
          example: Incomplete documentation
        reviewNotes:
          type: string
          description: Detailed review notes explaining the rejection
          example: >-
            The following documents are missing: Certificate of Slaughter,
            Ingredient declarations. Please resubmit with complete
            documentation.
      required:
        - rejectionReason
        - reviewNotes
    UpdateRequestDto:
      type: object
      properties:
        companyId:
          type: string
          description: Company ID
          format: uuid
        companyName:
          type: string
          description: Company name
          maxLength: 255
        contactPerson:
          type: string
          description: Contact person name
          maxLength: 255
        contactEmail:
          type: string
          description: Contact email
          format: email
          example: contact@company.com
        contactPhone:
          type: string
          description: Contact phone number
          example: +55 11 99999-9999
        requestType:
          type: string
          description: Request type
          enum: *ref_63
          example: nova
        certificationType:
          type: string
          description: Certification type
          enum: *ref_64
          example: C1
        productDescription:
          type: string
          description: Product description
          example: Halal certified frozen chicken products
        productIngredients:
          type: string
          description: Product ingredients list
          example: Chicken, salt, spices
        facilityAddress:
          type: string
          description: Facility address
          example: Rua Example, 123
        facilityCity:
          type: string
          description: Facility city
          maxLength: 100
          example: São Paulo
        facilityState:
          type: string
          description: Facility state
          maxLength: 50
          example: SP
        facilityCountry:
          type: string
          description: Facility country
          maxLength: 50
          example: Brasil
        facilityPostalCode:
          type: string
          description: Facility postal code
          maxLength: 20
          example: 01234-567
        previousCertificates:
          type: boolean
          description: Has previous Halal certificates
          default: false
        certifyingBody:
          type: string
          description: Previous certifying body name
          maxLength: 255
          example: Islamic Certification Body
        certificateNumber:
          type: string
          description: Previous certificate number
          maxLength: 100
          example: HALAL-2023-001
        certificateExpiry:
          format: date-time
          type: string
          description: Previous certificate expiry date
          example: '2025-12-31T23:59:59Z'
        industrialGroupId:
          type: string
          description: Industrial group ID
          format: uuid
        industrialCategoryId:
          type: string
          description: Industrial category ID
          format: uuid
        industrialSubcategoryId:
          type: string
          description: Industrial subcategory ID
          format: uuid
        numberOfEmployees:
          type: number
          description: Number of employees
          minimum: 1
          example: 50
        annualProduction:
          type: string
          description: Annual production volume
          example: 1000 tons/year
        rawMaterialSuppliers:
          type: number
          description: Number of raw material suppliers
          minimum: 0
          example: 10
        additionalInfo:
          type: string
          description: Additional information
          example: We follow strict Halal guidelines in all processes
    CreateCompanyDto:
      type: object
      properties:
        razaoSocial:
          type: string
          description: Legal company name (Razão Social)
          maxLength: 255
          example: Halal Foods Ltda
        nomeFantasia:
          type: string
          description: Trade name (Nome Fantasia)
          maxLength: 255
          example: Halal Foods
        cnpj:
          type: string
          description: 'Brazilian Tax ID (CNPJ) - format: 00.000.000/0000-00'
          example: 12.345.678/0001-90
          pattern: ^\d{2}\.\d{3}\.\d{3}/\d{4}-\d{2}$
        email:
          type: string
          description: Company email
          format: email
          example: contact@halalfoods.com
        telefone:
          type: string
          description: Company phone number
          example: +55 11 99999-9999
        endereco:
          type: string
          description: Company address
          example: Rua Example, 123, Suite 456
        cidade:
          type: string
          description: City
          maxLength: 100
          example: São Paulo
        estado:
          type: string
          description: State
          maxLength: 50
          example: SP
        pais:
          type: string
          description: Country
          maxLength: 50
          example: Brasil
          default: Brasil
        cep:
          type: string
          description: Postal code (CEP)
          maxLength: 20
          example: 01234-567
        website:
          type: string
          description: Company website
          format: url
          example: https://www.halalfoods.com
        inscricaoEstadual:
          type: string
          description: State tax registration (Inscrição Estadual)
          maxLength: 50
          example: 123.456.789.012
        inscricaoMunicipal:
          type: string
          description: Municipal tax registration (Inscrição Municipal)
          maxLength: 50
          example: '123456789'
      required:
        - razaoSocial
        - cnpj
        - email
        - telefone
        - endereco
        - cidade
        - estado
        - pais
        - cep
    RegisterCompanyDto:
      type: object
      properties:
        cnpj:
          type: string
          description: CNPJ (14 digits)
          example: '12345678000190'
        razaoSocial:
          type: string
          description: Razão Social (legal name)
          example: Empresa Halal Ltda
        nomeFantasia:
          type: string
          description: Nome Fantasia (trade name)
          example: Halal Foods
        address:
          description: Address data
          allOf:
            - $ref: '#/components/schemas/CompanyAddressDto'
        contact:
          description: Contact data
          allOf:
            - $ref: '#/components/schemas/CompanyContactDto'
        website:
          type: string
        numEmployees:
          type: number
        annualRevenue:
          type: number
        mainActivity:
          type: string
        isIndependent:
          type: boolean
          description: >-
            If true, creates an independent company. If false/omitted, company
            can be added to existing group later.
          default: true
        groupId:
          type: string
          description: Group ID to join (if company belongs to an existing group)
      required:
        - cnpj
        - razaoSocial
    UpdateCompanyDto:
      type: object
      properties:
        razaoSocial:
          type: string
          description: Legal company name (Razão Social)
          maxLength: 255
          example: Halal Foods Ltda
        nomeFantasia:
          type: string
          description: Trade name (Nome Fantasia)
          maxLength: 255
          example: Halal Foods
        email:
          type: string
          description: Company email
          format: email
          example: contact@halalfoods.com
        telefone:
          type: string
          description: Company phone number
          example: +55 11 99999-9999
        endereco:
          type: string
          description: Company address
          example: Rua Example, 123, Suite 456
        cidade:
          type: string
          description: City
          maxLength: 100
          example: São Paulo
        estado:
          type: string
          description: State
          maxLength: 50
          example: SP
        pais:
          type: string
          description: Country
          maxLength: 50
          example: Brasil
          default: Brasil
        cep:
          type: string
          description: Postal code (CEP)
          maxLength: 20
          example: 01234-567
        website:
          type: string
          description: Company website
          format: url
          example: https://www.halalfoods.com
        inscricaoEstadual:
          type: string
          description: State tax registration (Inscrição Estadual)
          maxLength: 50
          example: 123.456.789.012
        inscricaoMunicipal:
          type: string
          description: Municipal tax registration (Inscrição Municipal)
          maxLength: 50
          example: '123456789'
    VerifyCompanyDto:
      type: object
      properties:
        verificationNotes:
          type: string
          description: Verification notes from admin
          example: >-
            Company documentation verified. CNPJ is valid and matches federal
            records.
    ValidateCompanyDto:
      type: object
      properties:
        notes:
          type: string
          description: Notes about the validation
    CreateCompanyGroupDto:
      type: object
      properties:
        name:
          type: string
          description: Razão social do grupo
          example: BRF S.A.
          maxLength: 255
        tradeName:
          type: string
          description: Nome fantasia do grupo
          example: BRF
          maxLength: 255
        document:
          type: string
          description: CNPJ da holding/matriz (apenas dígitos)
          example: '12345678000199'
          maxLength: 20
        contactName:
          type: string
          description: Nome do contato principal
          example: João da Silva
          maxLength: 255
        contactEmail:
          type: string
          description: Email do contato principal
          example: contato@brf.com
          maxLength: 255
        contactPhone:
          type: string
          description: Telefone do contato principal
          example: '+5511999999999'
          maxLength: 50
      required:
        - name
    UpdateCompanyGroupDto:
      type: object
      properties:
        name:
          type: string
          description: Razão social do grupo
          example: BRF S.A.
          maxLength: 255
        tradeName:
          type: string
          description: Nome fantasia do grupo
          example: BRF
          maxLength: 255
        document:
          type: string
          description: CNPJ da holding/matriz (apenas dígitos)
          example: '12345678000199'
          maxLength: 20
        contactName:
          type: string
          description: Nome do contato principal
          example: João da Silva
          maxLength: 255
        contactEmail:
          type: string
          description: Email do contato principal
          example: contato@brf.com
          maxLength: 255
        contactPhone:
          type: string
          description: Telefone do contato principal
          example: '+5511999999999'
          maxLength: 50
    CreatePlantDto:
      type: object
      properties:
        companyId:
          type: string
          description: ID da empresa dona da planta
          example: 550e8400-e29b-41d4-a716-446655440000
        code:
          type: string
          description: Código da planta (SIF, SIE, SIM ou interno)
          example: SIF 1234
          maxLength: 50
        codeType:
          type: string
          description: Tipo do código da planta
          enum: &ref_65
            - sif
            - sie
            - sim
            - internal
          example: sif
        name:
          type: string
          description: Nome da planta/unidade
          example: Unidade Principal - São Paulo
          maxLength: 255
        address:
          type: string
          description: Endereço completo da planta
          example: Av. Industrial, 1000 - Distrito Industrial
        city:
          type: string
          description: Cidade
          example: São Paulo
          maxLength: 100
        state:
          type: string
          description: Estado/UF
          example: SP
          maxLength: 100
        postalCode:
          type: string
          description: CEP
          example: 01234-567
          maxLength: 20
        country:
          type: string
          description: País (código ISO)
          example: BR
          default: BR
          maxLength: 10
        productionCapacity:
          type: string
          description: Capacidade de produção
          example: 10.000 kg/dia
          maxLength: 255
        employeeCount:
          type: number
          description: Número de funcionários
          example: 150
          minimum: 0
        shiftsCount:
          type: number
          description: Número de turnos de trabalho
          example: 3
          minimum: 1
        isActive:
          type: boolean
          description: Planta ativa?
          default: true
      required:
        - companyId
        - code
        - codeType
        - name
        - address
    UpdatePlantDto:
      type: object
      properties:
        code:
          type: string
          description: Código da planta (SIF, SIE, SIM ou interno)
          example: SIF 1234
          maxLength: 50
        codeType:
          type: string
          description: Tipo do código da planta
          enum: *ref_65
          example: sif
        name:
          type: string
          description: Nome da planta/unidade
          example: Unidade Principal - São Paulo
          maxLength: 255
        address:
          type: string
          description: Endereço completo da planta
          example: Av. Industrial, 1000 - Distrito Industrial
        city:
          type: string
          description: Cidade
          example: São Paulo
          maxLength: 100
        state:
          type: string
          description: Estado/UF
          example: SP
          maxLength: 100
        postalCode:
          type: string
          description: CEP
          example: 01234-567
          maxLength: 20
        country:
          type: string
          description: País (código ISO)
          example: BR
          default: BR
          maxLength: 10
        productionCapacity:
          type: string
          description: Capacidade de produção
          example: 10.000 kg/dia
          maxLength: 255
        employeeCount:
          type: number
          description: Número de funcionários
          example: 150
          minimum: 0
        shiftsCount:
          type: number
          description: Número de turnos de trabalho
          example: 3
          minimum: 1
        isActive:
          type: boolean
          description: Planta ativa?
          default: true
    CreateSharedSupplierDto:
      type: object
      properties:
        groupId:
          type: string
          description: ID do grupo empresarial
        name:
          type: string
          description: Nome do fornecedor
          example: Ingredientes Halal Ltda
          maxLength: 255
        document:
          type: string
          description: CNPJ do fornecedor
          example: '12345678000199'
          maxLength: 20
        contactName:
          type: string
          description: Nome do contato
          example: João Silva
          maxLength: 255
        contactEmail:
          type: string
          description: Email do contato
          example: joao@fornecedor.com
          maxLength: 255
        contactPhone:
          type: string
          description: Telefone do contato
          example: '+5511999999999'
          maxLength: 50
        products:
          description: Lista de produtos fornecidos
          example: &ref_66
            - Carne bovina
            - Frango
          type: array
          items:
            type: string
        halalCertificateUrl:
          type: string
          description: URL do certificado Halal do fornecedor
        halalCertificateExpiry:
          type: string
          description: Data de validade do certificado Halal
      required:
        - groupId
        - name
    UpdateSharedSupplierDto:
      type: object
      properties:
        name:
          type: string
          description: Nome do fornecedor
          example: Ingredientes Halal Ltda
          maxLength: 255
        document:
          type: string
          description: CNPJ do fornecedor
          example: '12345678000199'
          maxLength: 20
        contactName:
          type: string
          description: Nome do contato
          example: João Silva
          maxLength: 255
        contactEmail:
          type: string
          description: Email do contato
          example: joao@fornecedor.com
          maxLength: 255
        contactPhone:
          type: string
          description: Telefone do contato
          example: '+5511999999999'
          maxLength: 50
        products:
          description: Lista de produtos fornecidos
          example: *ref_66
          type: array
          items:
            type: string
        halalCertificateUrl:
          type: string
          description: URL do certificado Halal do fornecedor
        halalCertificateExpiry:
          type: string
          description: Data de validade do certificado Halal
    CreateCorporateDocumentDto:
      type: object
      properties:
        groupId:
          type: string
          description: ID do grupo empresarial
        name:
          type: string
          description: Nome do documento
          example: Manual de BPF - Rev. 10
          maxLength: 255
        description:
          type: string
          description: Descrição do documento
          example: Manual de Boas Práticas de Fabricação atualizado
        category:
          type: string
          description: Categoria do documento
          enum: &ref_67
            - bpf
            - appcc
            - procedimento
            - manual
            - politica
            - outro
          example: bpf
        fileUrl:
          type: string
          description: URL do arquivo no storage
          example: https://storage.example.com/docs/manual-bpf.pdf
        fileName:
          type: string
          description: Nome original do arquivo
          example: manual-bpf-rev10.pdf
          maxLength: 255
        fileSize:
          type: number
          description: Tamanho do arquivo em bytes
          example: 1048576
        mimeType:
          type: string
          description: Tipo MIME do arquivo
          example: application/pdf
          maxLength: 100
        validUntil:
          type: string
          description: Data de validade do documento
        version:
          type: string
          description: Versão do documento
          example: '10.0'
          maxLength: 20
      required:
        - groupId
        - name
        - category
        - fileUrl
        - fileName
        - fileSize
        - mimeType
    UpdateCorporateDocumentDto:
      type: object
      properties:
        name:
          type: string
          description: Nome do documento
          example: Manual de BPF - Rev. 10
          maxLength: 255
        description:
          type: string
          description: Descrição do documento
          example: Manual de Boas Práticas de Fabricação atualizado
        category:
          type: string
          description: Categoria do documento
          enum: *ref_67
          example: bpf
        fileUrl:
          type: string
          description: URL do arquivo no storage
          example: https://storage.example.com/docs/manual-bpf.pdf
        fileName:
          type: string
          description: Nome original do arquivo
          example: manual-bpf-rev10.pdf
          maxLength: 255
        fileSize:
          type: number
          description: Tamanho do arquivo em bytes
          example: 1048576
        mimeType:
          type: string
          description: Tipo MIME do arquivo
          example: application/pdf
          maxLength: 100
        validUntil:
          type: string
          description: Data de validade do documento
        version:
          type: string
          description: Versão do documento
          example: '10.0'
          maxLength: 20
    CreateProcessDto:
      type: object
      properties:
        requestType:
          type: string
          enum:
            - nova
            - inicial
            - renovacao
            - ampliacao
            - manutencao
            - adequacao
          example: nova
          description: 'Tipo de solicitação (default: nova)'
        certificationType:
          type: string
          enum:
            - C1
            - C2
            - C3
            - C4
            - C5
            - C6
            - produto
            - processo
            - servico
          example: C1
          description: 'Tipo de certificação (default: C1)'
        companyName:
          type: string
          example: Empresa Exemplo Ltda
        cnpj:
          type: string
          example: '12345678000190'
          minLength: 14
        address:
          type: string
          example: Rua Exemplo, 123
        phone:
          type: string
          example: +55 11 98765-4321
        contactName:
          type: string
          example: João Silva
        contactEmail:
          type: string
          example: joao@empresa.com
        industrialGroup:
          type: string
          example: C10
          description: Código do grupo industrial (GSO 2055-2)
        industrialCategory:
          type: string
          example: C10.5
          description: Código da categoria industrial
        industrialSubcategory:
          type: string
          example: C10.51
          description: Código da subcategoria industrial
        productOrigin:
          type: string
          enum:
            - animal
            - vegetal
            - misto
            - quimico
          example: animal
          description: 'Origem do produto (default: misto)'
        productType:
          type: string
          example: Alimentos
        productDescription:
          type: string
          example: Queijo artesanal produzido com leite integral
          minLength: 10
        productCategory:
          type: string
          example: Lácteos
        productionCapacity:
          type: string
          example: 1000 kg/dia
        productionAddress:
          type: string
          example: Rod. BR-101, KM 50
        hasOtherCertifications:
          type: boolean
          example: true
        otherCertifications:
          type: string
          example: ISO 9001, ISO 22000
        ingredients:
          type: string
          example: Leite, sal, culturas lácticas, coalho
        suppliers:
          type: string
          example: Fazenda São José, Laticínios ABC
        hasAnimalIngredients:
          type: boolean
          example: true
        animalIngredientDetails:
          type: string
          example: Leite de vaca integral
        agreedToTerms:
          type: boolean
          example: true
      required:
        - companyName
        - cnpj
        - address
        - phone
        - contactName
        - contactEmail
        - industrialGroup
        - industrialCategory
        - industrialSubcategory
        - productType
        - productDescription
        - productCategory
        - productionCapacity
        - productionAddress
        - hasOtherCertifications
        - ingredients
        - suppliers
        - hasAnimalIngredients
        - agreedToTerms
    UpdateProcessDto:
      type: object
      properties:
        companyName:
          type: string
          example: Empresa Exemplo Ltda
        cnpj:
          type: string
          example: '12345678000190'
        address:
          type: string
          example: Rua Exemplo, 123
        phone:
          type: string
          example: +55 11 98765-4321
        contactName:
          type: string
          example: João Silva
        contactEmail:
          type: string
          example: joao@empresa.com
        industrialGroup:
          type: string
          example: C10
        industrialCategory:
          type: string
          example: C10.5
        industrialSubcategory:
          type: string
          example: C10.51
        productType:
          type: string
          example: Alimentos
        productDescription:
          type: string
          example: Queijo artesanal produzido com leite integral
        productCategory:
          type: string
          example: Lácteos
        productionCapacity:
          type: string
          example: 1000 kg/dia
        productionAddress:
          type: string
          example: Rod. BR-101, KM 50
        hasOtherCertifications:
          type: boolean
          example: true
        otherCertifications:
          type: string
          example: ISO 9001, ISO 22000
        ingredients:
          type: string
          example: Leite, sal, culturas lácticas, coalho
        suppliers:
          type: string
          example: Fazenda São José, Laticínios ABC
        hasAnimalIngredients:
          type: boolean
          example: true
        animalIngredientDetails:
          type: string
          example: Leite de vaca integral
    UpdateProcessStatusDto:
      type: object
      properties:
        status:
          type: string
          enum:
            - rascunho
            - pendente
            - em_andamento
            - aguardando_documentos
            - analise_documental
            - analise_tecnica
            - aguardando_auditoria
            - proposta_enviada
            - aguardando_assinatura
            - em_auditoria
            - concluido
            - aprovado
            - reprovado
            - certificado
            - cancelado
            - suspenso
          example: em_andamento
          description: Novo status do processo
        notes:
          type: string
          example: Documentação aprovada, avançando para próxima fase
      required:
        - status
    AssignAnalystDto:
      type: object
      properties:
        analystId:
          type: string
          example: 550e8400-e29b-41d4-a716-446655440000
          description: ID do analista a ser atribuído
        priority:
          type: string
          enum:
            - baixa
            - media
            - alta
            - urgente
          example: media
          description: Prioridade do processo
      required:
        - analystId
    CalculationInputDto:
      type: object
      properties:
        certificationType:
          type: string
          enum:
            - C1
            - C2
            - C3
            - C4
            - C5
            - C6
            - produto
            - processo
            - servico
          example: C1
          description: Type of certification (C1-C6)
        requestType:
          type: string
          enum:
            - nova
            - inicial
            - renovacao
            - ampliacao
            - manutencao
            - adequacao
          example: nova
          description: Type of request (nova, manutencao, adequacao)
        numProducts:
          type: number
          example: 15
          description: Number of products to be certified
          minimum: 1
        numShifts:
          type: number
          example: 2
          description: Number of work shifts (1-3)
          minimum: 1
          maximum: 3
        numSuppliers:
          type: number
          example: 5
          description: Number of suppliers
          minimum: 0
        numEmployees:
          type: number
          example: 75
          description: Number of employees
          minimum: 1
        distance:
          type: number
          example: 250
          description: Distance to company location (km)
          minimum: 0
        requiresAccommodation:
          type: boolean
          example: true
          description: Whether accommodation is required for auditors
      required:
        - certificationType
        - requestType
        - numProducts
        - numShifts
        - numSuppliers
        - numEmployees
        - distance
        - requiresAccommodation
    CreateProposalDto:
      type: object
      properties:
        processId:
          type: string
          example: 550e8400-e29b-41d4-a716-446655440000
          description: Process ID to create proposal for
        certificationId:
          type: string
          example: 550e8400-e29b-41d4-a716-446655440001
          description: Certification ID to associate proposal with
        calculationInputs:
          description: Calculation input parameters
          allOf:
            - $ref: '#/components/schemas/CalculationInputDto'
      required:
        - processId
        - calculationInputs
    AdjustProposalDto:
      type: object
      properties:
        manualAdjustment:
          type: number
          example: -500
          description: >-
            Manual adjustment amount (can be positive or negative). Added to
            calculated value.
        adjustmentReason:
          type: string
          example: Desconto comercial aprovado pelo coordenador
          description: Reason for the adjustment (required for audit trail)
      required:
        - manualAdjustment
        - adjustmentReason
    RespondProposalDto:
      type: object
      properties:
        accepted:
          type: boolean
          example: true
          description: Whether the proposal is accepted (true) or rejected (false)
        responseNotes:
          type: string
          example: Proposta aceita. Aguardamos o contrato.
          description: Optional notes from the company about their decision
      required:
        - accepted
    CreatePricingTableDto:
      type: object
      properties:
        version:
          type: string
          example: v1.0
          description: Version identifier (e.g., v1.0, v1.1)
        effectiveFrom:
          format: date-time
          type: string
          example: '2026-01-15T00:00:00.000Z'
          description: Date from which this pricing table becomes effective
        country:
          type: string
          example: BR
          description: Country for this pricing table
        currency:
          type: string
          example: BRL
          description: Currency for all prices in this table
        basePrices:
          type: object
          example: &ref_68
            C1: 5000
            C2: 6000
            C3: 7000
            C4: 8000
            C5: 9000
            C6: 10000
          description: Base prices for each certification type (C1-C6)
        productMultipliers:
          type: object
          example: &ref_69
            1-10: 1
            11-50: 1.3
            51-100: 1.6
            100+: 2
          description: Product count multipliers
        shiftMultipliers:
          type: object
          example: &ref_70
            '1': 1
            '2': 1.4
            '3': 1.8
          description: Shift count multipliers
        historyMultipliers:
          type: object
          example: &ref_71
            nova: 1
            manutencao: 0.8
            adequacao: 0.9
          description: Request type/history multipliers
        supplierMultipliers:
          type: object
          example: &ref_72
            1-5: 1
            6-15: 1.2
            16+: 1.5
          description: Supplier count multipliers
        manHourRates:
          type: object
          example: &ref_73
            1-50:
              hours: 8
              rate: 150
            51-150:
              hours: 16
              rate: 150
            151-300:
              hours: 24
              rate: 150
            300+:
              hours: 32
              rate: 150
          description: Man-hour rates by employee count ranges
        travelCosts:
          type: object
          example: &ref_74
            0-100: 200
            100-300: 500
            300-500: 800
            500+: 1200
          description: Travel costs by distance ranges (km)
        accommodationCost:
          type: number
          example: 300
          description: Accommodation cost per night (if required)
          minimum: 0
        documentAnalysisFee:
          type: number
          example: 800
          description: Document analysis fee (fixed)
          minimum: 0
        committeeFee:
          type: number
          example: 1200
          description: Technical committee review fee (fixed)
          minimum: 0
        issuanceFee:
          type: number
          example: 500
          description: Certificate issuance fee (fixed)
          minimum: 0
        taxRate:
          type: number
          example: 15
          description: Tax rate as percentage (e.g., 15 for 15%)
          minimum: 0
          maximum: 100
      required:
        - version
        - effectiveFrom
        - basePrices
        - productMultipliers
        - shiftMultipliers
        - historyMultipliers
        - supplierMultipliers
        - manHourRates
        - travelCosts
        - accommodationCost
        - documentAnalysisFee
        - committeeFee
        - issuanceFee
        - taxRate
    UpdatePricingTableDto:
      type: object
      properties:
        effectiveFrom:
          format: date-time
          type: string
          example: '2026-01-15T00:00:00.000Z'
          description: Date from which this pricing table becomes effective
        country:
          type: string
          example: BR
          description: Country for this pricing table
        currency:
          type: string
          example: BRL
          description: Currency for all prices in this table
        basePrices:
          type: object
          example: *ref_68
          description: Base prices for each certification type (C1-C6)
        productMultipliers:
          type: object
          example: *ref_69
          description: Product count multipliers
        shiftMultipliers:
          type: object
          example: *ref_70
          description: Shift count multipliers
        historyMultipliers:
          type: object
          example: *ref_71
          description: Request type/history multipliers
        supplierMultipliers:
          type: object
          example: *ref_72
          description: Supplier count multipliers
        manHourRates:
          type: object
          example: *ref_73
          description: Man-hour rates by employee count ranges
        travelCosts:
          type: object
          example: *ref_74
          description: Travel costs by distance ranges (km)
        accommodationCost:
          type: number
          example: 300
          description: Accommodation cost per night (if required)
          minimum: 0
        documentAnalysisFee:
          type: number
          example: 800
          description: Document analysis fee (fixed)
          minimum: 0
        committeeFee:
          type: number
          example: 1200
          description: Technical committee review fee (fixed)
          minimum: 0
        issuanceFee:
          type: number
          example: 500
          description: Certificate issuance fee (fixed)
          minimum: 0
        taxRate:
          type: number
          example: 15
          description: Tax rate as percentage (e.g., 15 for 15%)
          minimum: 0
          maximum: 100
    CreateAuditDto:
      type: object
      properties:
        processId:
          type: string
          example: 123e4567-e89b-12d3-a456-426614174000
          description: Process ID to audit
        certificationId:
          type: string
          example: 123e4567-e89b-12d3-a456-426614174001
          description: Certification ID (optional)
        auditorId:
          type: string
          example: 123e4567-e89b-12d3-a456-426614174002
          description: Auditor ID to assign (optional)
        auditType:
          type: string
          enum:
            - inicial
            - estagio1
            - estagio2
            - vigilancia
            - renovacao
            - especial
            - follow_up
          example: estagio1
          description: >-
            Type of audit: estagio1 (initial), estagio2 (follow-up), vigilancia
            (surveillance), especial (special)
        scheduledDate:
          format: date-time
          type: string
          example: '2026-02-15T10:00:00.000Z'
          description: Scheduled date and time for the audit
        location:
          type: object
          example:
            tipo: presencial
            endereco: Rua Example, 123, São Paulo, SP
          description: 'Location details: {tipo: "presencial"|"remota", endereco?: string}'
        auditorNotes:
          type: string
          example: Auditoria inicial para certificação C1
          description: Initial notes about the audit
        isUnannounced:
          type: boolean
          example: false
          description: Whether this is an unannounced audit (PR 7.1 Rev. 22 - 7.5.3.5)
          default: false
        unannouncedWindowStart:
          format: date-time
          type: string
          example: '2026-01-01T00:00:00.000Z'
          description: Start of allowed window for unannounced audit
        unannouncedWindowEnd:
          format: date-time
          type: string
          example: '2026-12-31T23:59:59.000Z'
          description: End of allowed window for unannounced audit
      required:
        - processId
        - auditType
        - scheduledDate
        - location
    UpdateAuditDto:
      type: object
      properties:
        scheduledDate:
          format: date-time
          type: string
          example: '2026-02-20T14:00:00.000Z'
          description: Rescheduled date and time
        location:
          type: object
          example:
            tipo: remota
            endereco: null
          description: Updated location details
        auditorNotes:
          type: string
          example: Auditoria remota devido a distância
          description: Updated notes
    StartAuditDto:
      type: object
      properties:
        auditorNotes:
          type: string
          example: Iniciando auditoria conforme planejado
          description: Notes when starting the audit
    CompleteAuditDto:
      type: object
      properties:
        findings:
          type: object
          example:
            conformidades:
              - Instalações adequadas para produção Halal
              - Documentação de fornecedores em ordem
            nao_conformidades:
              - item: Falta de segregação entre produtos Halal e não-Halal
                gravidade: maior
                acao_corretiva: Implementar área separada até 15/03/2026
          description: >-
            Audit findings with conformities and non-conformities:
            {conformidades: string[], nao_conformidades: Array<{item, gravidade,
            acao_corretiva}>}
        auditorNotes:
          type: string
          example: >-
            Auditoria concluída. Identificada 1 não-conformidade maior que
            requer ação corretiva.
          description: Final notes from auditor
      required:
        - findings
    FinalizeAuditDto:
      type: object
      properties:
        result:
          type: string
          enum:
            - aprovado
            - aprovado_condicional
            - reprovado
          example: aprovado
          description: >-
            Audit result: aprovado (approved), aprovado_condicional
            (conditionally approved), reprovado (rejected)
        auditorNotes:
          type: string
          example: >-
            Processo aprovado após verificação das ações corretivas
            implementadas.
          description: Justification for the decision
      required:
        - result
    CancelAuditDto:
      type: object
      properties:
        reason:
          type: string
          description: Motivo do cancelamento
          example: Cliente solicitou reagendamento
      required:
        - reason
    CreateContractDto:
      type: object
      properties:
        processId:
          type: string
          description: ID do processo de certificação
          example: 123e4567-e89b-12d3-a456-426614174000
        companyId:
          type: string
          description: ID da empresa
          example: 123e4567-e89b-12d3-a456-426614174001
        certificationId:
          type: string
          description: ID da certificação (novo campo)
          example: 123e4567-e89b-12d3-a456-426614174002
        contractType:
          type: string
          description: Tipo de contrato
          enum:
            - proposta
            - contrato
          example: contrato
        totalValue:
          type: number
          description: Valor total do contrato
          example: 15000
          minimum: 0
        numInstallments:
          type: number
          description: Número de parcelas
          example: 12
          minimum: 1
          maximum: 24
        validityMonths:
          type: number
          description: Período de validade do contrato em meses
          example: 12
          minimum: 1
          maximum: 60
        pdfUrl:
          type: string
          description: URL do PDF do contrato (opcional)
          example: https://storage.example.com/contracts/contract-2024-001.pdf
      required:
        - processId
        - companyId
        - contractType
        - totalValue
        - numInstallments
        - validityMonths
    SignContractDto:
      type: object
      properties:
        signedAt:
          format: date-time
          type: string
          description: Data e hora da assinatura do contrato
          example: '2024-01-15T10:30:00Z'
      required:
        - signedAt
    CancelContractDto:
      type: object
      properties:
        reason:
          type: string
          description: Motivo do cancelamento (opcional)
          example: Cliente desistiu da certificação
    UpdateContractDto:
      type: object
      properties:
        numInstallments:
          type: number
          description: Número de parcelas
          example: 12
          minimum: 1
          maximum: 24
        validityMonths:
          type: number
          description: Período de validade do contrato em meses
          example: 12
          minimum: 1
          maximum: 60
        totalValue:
          type: number
          description: Valor total do contrato
          example: 15000
          minimum: 0
        pdfUrl:
          type: string
          description: URL do PDF do contrato
          example: https://storage.example.com/contracts/contract-2024-001.pdf
    CreateDocumentRequestDto:
      type: object
      properties:
        processId:
          type: string
          description: ID do processo
          example: 123e4567-e89b-12d3-a456-426614174000
        documentType:
          type: string
          description: Tipo de documento
          enum:
            - contrato_social
            - certidao_negativa
            - alvara_funcionamento
            - laudo_tecnico
            - licenca_sanitaria
            - fotos
            - videos
            - laudos
            - manual_bpf
            - fluxograma_processo
            - lista_fornecedores
            - certificado_ingredientes
            - analise_produto
            - rotulo_produto
            - outros
        description:
          type: string
          description: Descrição da solicitação
          example: Enviar contrato social atualizado
        dueDate:
          format: date-time
          type: string
          description: Data limite para envio
      required:
        - processId
        - documentType
        - description
    UpdateDocumentRequestDto:
      type: object
      properties:
        description:
          type: string
          description: Descrição da solicitação
        dueDate:
          format: date-time
          type: string
          description: Data limite para envio
    FulfillDocumentRequestDto:
      type: object
      properties:
        uploadedDocId:
          type: string
          description: ID do documento enviado
          example: 123e4567-e89b-12d3-a456-426614174000
      required:
        - uploadedDocId
    CreateCommentDto:
      type: object
      properties:
        processId:
          type: string
          description: ID do processo ao qual o comentário pertence
          example: 123e4567-e89b-12d3-a456-426614174000
        content:
          type: string
          description: Conteúdo do comentário
          example: Documentação aprovada, processo pode avançar para próxima fase
          minLength: 1
        mentions:
          description: IDs dos usuários mencionados no comentário (@mentions)
          example:
            - user-id-1
            - user-id-2
          type: array
          items:
            type: string
        isInternal:
          type: boolean
          description: >-
            Se true, comentário é interno (visível apenas para equipe). Se
            false, visível para empresa também.
          example: false
          default: false
      required:
        - processId
        - content
    UpdateCommentDto:
      type: object
      properties:
        content:
          type: string
          description: Conteúdo atualizado do comentário
          example: Documentação aprovada após correções
          minLength: 1
        mentions:
          description: IDs atualizados dos usuários mencionados
          example:
            - user-id-1
            - user-id-3
          type: array
          items:
            type: string
        isInternal:
          type: boolean
          description: Atualizar visibilidade do comentário
          example: true
    AllocateAuditorDto:
      type: object
      properties:
        auditorId:
          type: string
          description: ID do auditor a ser alocado ao processo
          example: 123e4567-e89b-12d3-a456-426614174000
      required:
        - auditorId
    AuditReportDto:
      type: object
      properties:
        id:
          type: string
          description: Audit report ID
        auditNumber:
          type: string
          description: Audit number (e.g., AUD-2025-001)
        companyName:
          type: string
          description: Company name
        companyAddress:
          type: string
          description: Company address
        auditDate:
          type: string
          description: Audit date (ISO string)
        stage:
          type: string
          enum:
            - STAGE_1
            - STAGE_2
          description: Audit stage
        status:
          type: string
          enum:
            - COMPLIANT
            - NON_COMPLIANT
            - PENDING_CORRECTIONS
          description: Compliance status
        auditor:
          type: string
          description: Auditor name
        totalItems:
          type: number
          description: Total items evaluated
        conformItems:
          type: number
          description: Number of conforming items
        minorNCs:
          type: number
          description: Number of minor non-conformities
        majorNCs:
          type: number
          description: Number of major non-conformities
        score:
          type: number
          description: Compliance score (0-100)
        reportPdfUrl:
          type: string
          description: URL to the PDF report
        createdAt:
          type: string
          description: Report creation date (ISO string)
      required:
        - id
        - auditNumber
        - companyName
        - companyAddress
        - auditDate
        - stage
        - status
        - auditor
        - totalItems
        - conformItems
        - minorNCs
        - majorNCs
        - score
        - createdAt
    AuditReportListResponseDto:
      type: object
      properties:
        data:
          description: List of audit reports
          type: array
          items:
            $ref: '#/components/schemas/AuditReportDto'
        total:
          type: number
          description: Total count of reports matching the filter
        skip:
          type: number
          description: Current page offset
        take:
          type: number
          description: Items per page
      required:
        - data
        - total
        - skip
        - take
    AuditReportStatsDto:
      type: object
      properties:
        total:
          type: number
          description: Total number of reports
        compliant:
          type: number
          description: Number of compliant reports
        pendingCorrections:
          type: number
          description: Number of reports pending corrections
        nonCompliant:
          type: number
          description: Number of non-compliant reports
        averageScore:
          type: number
          description: Average compliance score
        totalMinorNCs:
          type: number
          description: Total minor non-conformities
        totalMajorNCs:
          type: number
          description: Total major non-conformities
      required:
        - total
        - compliant
        - pendingCorrections
        - nonCompliant
        - averageScore
        - totalMinorNCs
        - totalMajorNCs
    JuridicoDashboardStatsDto:
      type: object
      properties:
        totalContracts:
          type: number
          description: Total de contratos
          example: 25
        pendingElaboration:
          type: number
          description: Contratos aguardando elaboração
          example: 5
        pendingSignature:
          type: number
          description: Contratos aguardando assinatura
          example: 8
        signed:
          type: number
          description: Contratos assinados
          example: 10
        inNegotiation:
          type: number
          description: Contratos em negociação
          example: 2
        processesNeedingContract:
          type: number
          description: Processos que precisam de contrato
          example: 3
      required:
        - totalContracts
        - pendingElaboration
        - pendingSignature
        - signed
        - inNegotiation
        - processesNeedingContract
    JuridicoDashboardContractDto:
      type: object
      properties:
        id:
          type: string
          description: ID do contrato
        contractNumber:
          type: object
          description: Número do contrato
          example: CTR-2025-001
          nullable: true
        status:
          type: string
          description: Status do contrato
          example: rascunho
        createdAt:
          type: string
          description: Data de criação
        company:
          type: object
          description: Dados da empresa
        process:
          type: object
          description: Dados do processo
      required:
        - id
        - contractNumber
        - status
        - createdAt
        - company
        - process
    JuridicoDashboardProcessDto:
      type: object
      properties:
        id:
          type: string
          description: ID do processo
        requestId:
          type: string
          description: ID da solicitação
        currentPhase:
          type: string
          description: Fase atual do processo
        request:
          type: object
          description: Dados da solicitação
        proposal:
          type: object
          description: Dados da proposta
          nullable: true
      required:
        - id
        - requestId
        - currentPhase
        - request
        - proposal
    JuridicoDashboardActivityDto:
      type: object
      properties:
        id:
          type: string
          description: ID da atividade
        action:
          type: string
          description: Ação realizada
          example: create
        createdAt:
          type: string
          description: Data da atividade
        user:
          type: object
          description: Usuário que realizou a ação
        changes:
          type: object
          description: Detalhes das mudanças
          nullable: true
      required:
        - id
        - action
        - createdAt
        - user
        - changes
    JuridicoDashboardResponseDto:
      type: object
      properties:
        stats:
          description: Estatísticas do dashboard
          allOf:
            - $ref: '#/components/schemas/JuridicoDashboardStatsDto'
        pendingContracts:
          description: Contratos pendentes
          type: array
          items:
            $ref: '#/components/schemas/JuridicoDashboardContractDto'
        processesNeedingContract:
          description: Processos que precisam de contrato
          type: array
          items:
            $ref: '#/components/schemas/JuridicoDashboardProcessDto'
        recentActivity:
          description: Atividades recentes
          type: array
          items:
            $ref: '#/components/schemas/JuridicoDashboardActivityDto'
      required:
        - stats
        - pendingContracts
        - processesNeedingContract
        - recentActivity
    CreateCertificationDto:
      type: object
      properties:
        companyId:
          type: string
          description: ID da empresa
          example: 550e8400-e29b-41d4-a716-446655440000
        certificationType:
          type: string
          description: Tipo de certificação
          enum:
            - C1
            - C2
            - C3
            - C4
            - C5
            - C6
            - produto
            - processo
            - servico
          example: C1
        industrialGroupId:
          type: string
          description: ID do grupo industrial (GSO 2055-2)
          example: 550e8400-e29b-41d4-a716-446655440001
        industrialCategoryId:
          type: string
          description: ID da categoria industrial
          example: 550e8400-e29b-41d4-a716-446655440002
        industrialSubcategoryId:
          type: string
          description: ID da subcategoria industrial
          example: 550e8400-e29b-41d4-a716-446655440003
        analystId:
          type: string
          description: ID do analista responsável
          example: 550e8400-e29b-41d4-a716-446655440004
      required:
        - companyId
        - certificationType
    UpdateCertificationDto:
      type: object
      properties:
        certificationType:
          type: string
          description: Tipo de certificação
          enum:
            - C1
            - C2
            - C3
            - C4
            - C5
            - C6
            - produto
            - processo
            - servico
        status:
          type: string
          description: Status da certificação
          enum:
            - em_solicitacao
            - ativa
            - suspensa
            - cancelada
            - expirada
            - recusada
        industrialGroupId:
          type: string
          description: ID do grupo industrial
        industrialCategoryId:
          type: string
          description: ID da categoria industrial
        industrialSubcategoryId:
          type: string
          description: ID da subcategoria industrial
        analystId:
          type: string
          description: ID do analista responsável
        validFrom:
          type: string
          description: Data de início da validade
          example: '2026-01-20T00:00:00.000Z'
        validUntil:
          type: string
          description: Data de fim da validade
          example: '2029-01-20T00:00:00.000Z'
    SuspendCertificationDto:
      type: object
      properties:
        suspensionType:
          type: string
          description: Tipo de suspensão
          enum:
            - normal
            - entressafra
          example: normal
        reason:
          type: string
          description: Motivo da suspensão
          example: Não conformidade crítica identificada na auditoria
          minLength: 10
      required:
        - suspensionType
        - reason
    UpdateScopeDto:
      type: object
      properties:
        description:
          type: string
          description: Descrição geral do escopo
          example: Produção de alimentos processados Halal
        productionCapacity:
          type: string
          description: Capacidade produtiva
          example: 10.000 kg/dia
        numEmployees:
          type: number
          description: Número de funcionários
          example: 150
        numShifts:
          type: number
          description: Número de turnos
          example: 2
    CreateScopeProductDto:
      type: object
      properties:
        name:
          type: string
          description: Nome do produto
          example: Frango Halal Congelado
          maxLength: 255
        description:
          type: string
          description: Descrição do produto
          example: Frango inteiro congelado certificado Halal
        category:
          type: string
          description: Categoria do produto
          example: Carnes
          maxLength: 255
        origin:
          type: string
          description: Origem do produto
          enum:
            - animal
            - vegetal
            - misto
            - quimico
          example: animal
      required:
        - name
    UpdateScopeProductDto:
      type: object
      properties:
        name:
          type: string
          description: Nome do produto
        description:
          type: string
          description: Descrição do produto
        category:
          type: string
          description: Categoria do produto
        origin:
          type: string
          description: Origem do produto
          enum:
            - animal
            - vegetal
            - misto
            - quimico
        status:
          type: string
          description: Status do produto no escopo
          enum:
            - ativo
            - pendente
            - removido
    CreateScopeFacilityDto:
      type: object
      properties:
        name:
          type: string
          description: Nome da instalação
          example: Unidade Fabril São Paulo
          maxLength: 255
        address:
          type: string
          description: Endereço da instalação
          example: Rua das Indústrias, 1000
        city:
          type: string
          description: Cidade
          example: São Paulo
          maxLength: 100
        state:
          type: string
          description: Estado/Província
          example: SP
          maxLength: 100
        country:
          type: string
          description: País
          example: Brasil
          maxLength: 100
        postalCode:
          type: string
          description: CEP/Código Postal
          example: 01234-567
          maxLength: 20
        facilityType:
          type: string
          description: Tipo de instalação
          example: fabrica
          maxLength: 100
      required:
        - address
    UpdateScopeFacilityDto:
      type: object
      properties:
        name:
          type: string
          description: Nome da instalação
        address:
          type: string
          description: Endereço da instalação
        city:
          type: string
          description: Cidade
        state:
          type: string
          description: Estado/Província
        country:
          type: string
          description: País
        postalCode:
          type: string
          description: CEP/Código Postal
        facilityType:
          type: string
          description: Tipo de instalação
        status:
          type: string
          description: Status da instalação no escopo
          enum:
            - ativo
            - pendente
            - removido
    CreateScopeBrandDto:
      type: object
      properties:
        name:
          type: string
          description: Nome da marca
          example: Halal Premium
          maxLength: 255
        logoUrl:
          type: string
          description: URL do logo da marca
          example: https://storage.example.com/logos/halal-premium.png
      required:
        - name
    UpdateScopeBrandDto:
      type: object
      properties:
        name:
          type: string
          description: Nome da marca
        logoUrl:
          type: string
          description: URL do logo da marca
        status:
          type: string
          description: Status da marca no escopo
          enum:
            - ativo
            - pendente
            - removido
    CreateScopeSupplierDto:
      type: object
      properties:
        name:
          type: string
          description: Nome do fornecedor
          example: Ingredientes Halal Ltda
          maxLength: 255
        cnpj:
          type: string
          description: CNPJ do fornecedor
          example: '12345678000199'
          maxLength: 20
        ingredientType:
          type: string
          description: Tipo de ingrediente fornecido
          example: Gelatina Halal
          maxLength: 255
        hasHalalCertificate:
          type: boolean
          description: Possui certificado Halal?
          example: true
      required:
        - name
    UpdateScopeSupplierDto:
      type: object
      properties:
        name:
          type: string
          description: Nome do fornecedor
        cnpj:
          type: string
          description: CNPJ do fornecedor
        ingredientType:
          type: string
          description: Tipo de ingrediente fornecido
        hasHalalCertificate:
          type: boolean
          description: Possui certificado Halal?
        status:
          type: string
          description: Status do fornecedor no escopo
          enum:
            - ativo
            - pendente
            - removido
    CreateCertificationRequestDto:
      type: object
      properties:
        certificationId:
          type: string
          description: ID da certificação
          example: 550e8400-e29b-41d4-a716-446655440000
        requestType:
          type: string
          description: Tipo da solicitação
          enum:
            - nova
            - inicial
            - renovacao
            - ampliacao
            - manutencao
            - adequacao
          example: nova
        changeDescription:
          type: string
          description: Descrição da alteração (para manutenção/ajuste)
          example: Adição de nova linha de produtos veganos
        changeType:
          type: string
          description: Tipo de alteração
          example: adicao_produto
      required:
        - certificationId
        - requestType
    UpdateCertificationRequestDto:
      type: object
      properties:
        status:
          type: string
          description: Status da solicitação
          enum:
            - rascunho
            - enviado
            - pendente
            - em_analise
            - aprovado
            - rejeitado
            - cancelado
        changeDescription:
          type: string
          description: Descrição da alteração
        changeType:
          type: string
          description: Tipo de alteração
        reviewNotes:
          type: string
          description: Notas da revisão
        rejectionReason:
          type: string
          description: Motivo da rejeição
    CreateCertificateDto:
      type: object
      properties:
        processId:
          type: string
          example: 123e4567-e89b-12d3-a456-426614174000
          description: Process ID that generated this certificate
        certificationId:
          type: string
          example: 123e4567-e89b-12d3-a456-426614174001
          description: Certification ID (optional, for linking to unified certification)
        issuedById:
          type: string
          example: 123e4567-e89b-12d3-a456-426614174002
          description: User ID who issued the certificate
        issuedAt:
          type: string
          example: '2026-01-20T00:00:00.000Z'
          description: Date when certificate was issued
        expiresAt:
          type: string
          example: '2027-01-20T00:00:00.000Z'
          description: Certificate expiration date
        version:
          type: number
          example: 1
          description: 'Version number (default: 1, incremented on renewals)'
      required:
        - processId
        - issuedAt
        - expiresAt
    UpdateCertificateDto:
      type: object
      properties:
        status:
          type: string
          enum:
            - ativo
            - suspenso
            - cancelado
            - expirado
          example: ativo
          description: Certificate status
        expiresAt:
          type: string
          example: '2028-01-20T00:00:00.000Z'
          description: New expiration date (for extensions)
        pdfUrl:
          type: string
          example: /uploads/certificates/cert-123.pdf
          description: URL to the certificate PDF
        qrCodeUrl:
          type: string
          example: /uploads/qrcodes/qr-123.png
          description: URL to the QR code image
    UpdateWorkflowDto:
      type: object
      properties:
        status:
          type: string
          enum:
            - rascunho
            - pendente
            - em_andamento
            - aguardando_documentos
            - aguardando_empresa
            - aguardando_auditoria
            - em_auditoria
            - aguardando_comite
            - concluido
            - cancelado
            - suspenso
          description: New workflow status
        currentPhase:
          type: string
          enum:
            - cadastro_solicitacao
            - analise_documental_inicial
            - elaboracao_proposta
            - negociacao_proposta
            - proposta_aprovada
            - elaboracao_contrato
            - assinatura_contrato
            - avaliacao_documental
            - planejamento_auditoria
            - auditoria_estagio1
            - auditoria_estagio2
            - analise_nao_conformidades
            - correcao_nao_conformidades
            - validacao_correcoes
            - comite_tecnico
            - emissao_certificado
            - certificado_emitido
          description: New workflow phase
        priority:
          type: string
          enum:
            - baixa
            - media
            - alta
            - urgente
          description: Workflow priority
    AssignAnalystToWorkflowDto:
      type: object
      properties:
        analystId:
          type: string
          description: Analyst user ID to assign
        priority:
          type: string
          enum:
            - baixa
            - media
            - alta
            - urgente
          description: Workflow priority
      required:
        - analystId
    AssignAuditorToWorkflowDto:
      type: object
      properties:
        auditorId:
          type: string
          description: Auditor user ID to assign
      required:
        - auditorId
    AdvancePhaseDto:
      type: object
      properties:
        targetPhase:
          type: string
          enum:
            - cadastro_solicitacao
            - analise_documental_inicial
            - elaboracao_proposta
            - negociacao_proposta
            - proposta_aprovada
            - elaboracao_contrato
            - assinatura_contrato
            - avaliacao_documental
            - planejamento_auditoria
            - auditoria_estagio1
            - auditoria_estagio2
            - analise_nao_conformidades
            - correcao_nao_conformidades
            - validacao_correcoes
            - comite_tecnico
            - emissao_certificado
            - certificado_emitido
          description: Target phase to advance to
        notes:
          type: string
          description: Notes about the phase transition
      required:
        - targetPhase
    RejectAtCommitteeDto:
      type: object
      properties:
        reason:
          type: string
          example: >-
            Não conformidades críticas não foram adequadamente tratadas. Falhas
            no sistema APPCC identificadas.
          description: Reason for rejection (min 20 characters for proper documentation)
          minLength: 20
          maxLength: 2000
      required:
        - reason
    CancelCertificationDto:
      type: object
      properties:
        cancellationType:
          type: string
          enum:
            - pos_suspensao
            - distrato
          example: distrato
          description: >-
            Type of cancellation: pos_suspensao (after suspension) or distrato
            (contractual termination)
        reason:
          type: string
          example: Rescisão contratual solicitada pela empresa.
          description: Reason for cancellation (min 10 characters)
          minLength: 10
          maxLength: 2000
      required:
        - cancellationType
        - reason
    CreateInviteDto:
      type: object
      properties:
        companyId:
          type: string
          description: Company ID to invite user to
          example: 123e4567-e89b-12d3-a456-426614174000
        email:
          type: string
          description: Email of the user to invite
          example: newuser@example.com
        name:
          type: string
          description: Name of the invited user (optional)
          example: João Silva
        role:
          type: string
          description: Role to assign to the user (defaults to empresa)
          enum:
            - admin
            - empresa
            - analista
            - auditor
            - gestor
            - comercial
            - juridico
            - financeiro
            - gestor_auditoria
            - supervisor
            - controlador
            - secretaria
          default: empresa
      required:
        - companyId
        - email
    AcceptInviteDto:
      type: object
      properties:
        password:
          type: string
          description: Password for the new user account
          example: senha123
          minLength: 6
        name:
          type: string
          description: Name of the user (can update if different from invite)
          example: João Silva
        phone:
          type: string
          description: Phone number
          example: +55 11 98765-4321
      required:
        - password
    CreateAccessRequestDto:
      type: object
      properties:
        companyId:
          type: string
          description: ID of the company to request access to
          example: 123e4567-e89b-12d3-a456-426614174000
        message:
          type: string
          description: Optional message explaining why access is being requested
          example: Sou funcionário do setor de qualidade e preciso acessar o sistema.
      required:
        - companyId
    RespondAccessRequestDto:
      type: object
      properties:
        responseMessage:
          type: string
          description: Message explaining the decision (especially for rejections)
          example: Aprovado. Bem-vindo à equipe!
    ChatMessageDto:
      type: object
      properties:
        role:
          type: string
          enum:
            - user
            - assistant
            - system
          description: Role of the message sender
        content:
          type: string
          description: Message content
      required:
        - role
        - content
    ChatCompletionDto:
      type: object
      properties:
        messages:
          description: Conversation messages
          type: array
          items:
            $ref: '#/components/schemas/ChatMessageDto'
        model:
          type: string
          description: Model to use
          default: claude-3-5-sonnet-20241022
        temperature:
          type: number
          description: Temperature (0-1)
          default: 0.7
        maxTokens:
          type: number
          description: Max tokens to generate
          default: 1024
      required:
        - messages
    ExtractDataDto:
      type: object
      properties:
        conversationHistory:
          description: Conversation history
          type: array
          items:
            $ref: '#/components/schemas/ChatMessageDto'
        schema:
          type: object
          description: Schema for data extraction
      required:
        - conversationHistory
        - schema
    SuggestQuestionsDto:
      type: object
      properties:
        conversationHistory:
          description: Conversation history
          type: array
          items:
            $ref: '#/components/schemas/ChatMessageDto'
        completedFields:
          description: Already completed fields
          type: array
          items:
            type: string
      required:
        - conversationHistory
        - completedFields
    ValidateDataDto:
      type: object
      properties:
        data:
          type: object
          description: Data to validate
      required:
        - data
    CreateESignatureConfigDto:
      type: object
      properties:
        provider:
          type: string
          enum: &ref_75
            - clicksign
            - d4sign
            - docusign
            - adobe_sign
            - custom
            - none
          description: E-signature provider
          example: d4sign
        companyId:
          type: string
          description: Company ID (optional, for company-specific configs)
        apiKey:
          type: string
          description: Provider API Key
        apiSecret:
          type: string
          description: Provider API Secret
        webhookUrl:
          type: string
          description: Webhook URL for provider callbacks
        config:
          type: object
          description: Provider-specific configuration (JSON)
          example: &ref_76
            environment: sandbox
            safeId: ...
            cryptoKey: ...
        isActive:
          type: boolean
          description: Whether this config is active
          default: true
        isDefault:
          type: boolean
          description: Whether this is the default config for the company
          default: false
      required:
        - provider
    UpdateESignatureConfigDto:
      type: object
      properties:
        provider:
          type: string
          enum: *ref_75
          description: E-signature provider
          example: d4sign
        companyId:
          type: string
          description: Company ID (optional, for company-specific configs)
        apiKey:
          type: string
          description: Provider API Key
        apiSecret:
          type: string
          description: Provider API Secret
        webhookUrl:
          type: string
          description: Webhook URL for provider callbacks
        config:
          type: object
          description: Provider-specific configuration (JSON)
          example: *ref_76
        isActive:
          type: boolean
          description: Whether this config is active
          default: true
        isDefault:
          type: boolean
          description: Whether this is the default config for the company
          default: false
      required:
        - provider
    CreateStorageConfigDto:
      type: object
      properties:
        provider:
          type: string
          enum: &ref_77
            - s3
            - local
            - azure
            - gcp
            - cloudflare_r2
          description: Storage provider type
          example: s3
        accessKey:
          type: string
          description: Access Key / API Key
        secretKey:
          type: string
          description: Secret Key / API Secret
        region:
          type: string
          description: Region (AWS region, Azure location, etc)
        bucket:
          type: string
          description: Bucket/Container name
        endpoint:
          type: string
          description: Custom endpoint (MinIO, Cloudflare R2, etc)
        cdnUrl:
          type: string
          description: CDN URL (CloudFront, etc)
        maxFileSize:
          type: number
          description: Max file size in bytes
          default: 52428800
        allowedTypes:
          description: Allowed MIME types
          default: &ref_78
            - image/jpeg
            - image/png
            - application/pdf
          type: array
          items:
            type: string
        isDefault:
          type: boolean
          description: Whether this is the default config
          default: false
        isActive:
          type: boolean
          description: Whether this config is active
          default: true
      required:
        - provider
    UpdateStorageConfigDto:
      type: object
      properties:
        provider:
          type: string
          enum: *ref_77
          description: Storage provider type
          example: s3
        accessKey:
          type: string
          description: Access Key / API Key
        secretKey:
          type: string
          description: Secret Key / API Secret
        region:
          type: string
          description: Region (AWS region, Azure location, etc)
        bucket:
          type: string
          description: Bucket/Container name
        endpoint:
          type: string
          description: Custom endpoint (MinIO, Cloudflare R2, etc)
        cdnUrl:
          type: string
          description: CDN URL (CloudFront, etc)
        maxFileSize:
          type: number
          description: Max file size in bytes
          default: 52428800
        allowedTypes:
          description: Allowed MIME types
          default: *ref_78
          type: array
          items:
            type: string
        isDefault:
          type: boolean
          description: Whether this is the default config
          default: false
        isActive:
          type: boolean
          description: Whether this config is active
          default: true
      required:
        - provider
